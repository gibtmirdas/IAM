tinymce.PluginManager.add("lists",function(e){var a=this;function c(h){return h&&(/^(OL|UL)$/).test(h.nodeName)}function d(h){return h.parentNode.firstChild==h}function g(h){return h.parentNode.lastChild==h}function f(h){return h&&!!e.schema.getTextBlockElements()[h.nodeName]}function b(h){return h&&h.nodeName==="SPAN"&&h.getAttribute("data-mce-type")==="bookmark"}e.on("init",function(){var n=e.dom,v=e.selection;function u(x){var y={};function z(D){var B,A,C;A=x[D?"startContainer":"endContainer"];C=x[D?"startOffset":"endOffset"];if(A.nodeType==1){B=n.create("span",{"data-mce-type":"bookmark"});if(A.hasChildNodes()){C=Math.min(C,A.childNodes.length-1);if(D){A.insertBefore(B,A.childNodes[C])}else{n.insertAfter(B,A.childNodes[C])}}else{A.appendChild(B)}A=B;C=0}y[D?"startContainer":"endContainer"]=A;y[D?"startOffset":"endOffset"]=C}z(true);if(!x.collapsed){z()}return y}function t(y){function z(E){var A,C,B;function D(G){var H=G.parentNode.firstChild,F=0;while(H){if(H==G){return F}if(H.nodeType!=1||H.getAttribute("data-mce-type")!="bookmark"){F++}H=H.nextSibling}return -1}A=B=y[E?"startContainer":"endContainer"];C=y[E?"startOffset":"endOffset"];if(!A){return}if(A.nodeType==1){C=D(A);A=A.parentNode;n.remove(B)}y[E?"startContainer":"endContainer"]=A;y[E?"startOffset":"endOffset"]=C}z(true);z();var x=n.createRng();x.setStart(y.startContainer,y.startOffset);if(y.endContainer){x.setEnd(y.endContainer,y.endOffset)}v.setRng(x)}function l(x,B){var D,y,A=n.createFragment(),z;var C=e.schema.getBlockElements();if(e.settings.forced_root_block){B=B||e.settings.forced_root_block}if(B){y=n.create(B);if(y.tagName===e.settings.forced_root_block){n.setAttribs(y,e.settings.forced_root_block_attrs)}A.appendChild(y)}if(x){while((D=x.firstChild)){var E=D.nodeName;if(!z&&(E!="SPAN"||D.getAttribute("data-mce-type")!="bookmark")){z=true}if(C[E]){A.appendChild(D);y=null}else{if(B){if(!y){y=n.create(B);A.appendChild(y)}y.appendChild(D)}else{A.appendChild(D)}}}}if(!e.settings.forced_root_block){A.appendChild(n.create("br"))}else{if(!z&&(!tinymce.Env.ie||tinymce.Env.ie>10)){y.appendChild(n.create("br",{"data-mce-bogus":"1"}))}}return A}function p(){return tinymce.grep(v.getSelectedBlocks(),function(x){return x.nodeName=="LI"})}function o(A,x,C){var z,y;var B=n.select('span[data-mce-type="bookmark"]',A);C=C||l(x);z=n.createRng();z.setStartAfter(x);z.setEndAfter(A);y=z.extractContents();if(!n.isEmpty(y)){n.insertAfter(y,A)}n.insertAfter(C,A);if(n.isEmpty(x.parentNode)){tinymce.each(B,function(D){x.parentNode.parentNode.insertBefore(D,x.parentNode)});n.remove(x.parentNode)}n.remove(x)}function w(x){var y,z;y=x.nextSibling;if(y&&c(y)&&y.nodeName==x.nodeName){while((z=y.firstChild)){x.appendChild(z)}n.remove(y)}y=x.previousSibling;if(y&&c(y)&&y.nodeName==x.nodeName){while((z=y.firstChild)){x.insertBefore(z,x.firstChild)}n.remove(y)}}function h(x){tinymce.each(tinymce.grep(n.select("ol,ul",x)),function(z){var A,y=z.parentNode;if(y.nodeName=="LI"&&y.firstChild==z){A=y.previousSibling;if(A&&A.nodeName=="LI"){A.appendChild(z);if(n.isEmpty(y)){n.remove(y)}}}if(c(y)){A=y.previousSibling;if(A&&A.nodeName=="LI"){A.appendChild(z)}}})}function s(y){var z=y.parentNode,x=z.parentNode,B;function A(C){if(n.isEmpty(C)){n.remove(C)}}if(d(y)&&g(y)){if(x.nodeName=="LI"){n.insertAfter(y,x);A(x);n.remove(z)}else{if(c(x)){n.remove(z,true)}else{x.insertBefore(l(y),z);n.remove(z)}}return true}else{if(d(y)){if(x.nodeName=="LI"){n.insertAfter(y,x);y.appendChild(z);A(x)}else{if(c(x)){x.insertBefore(y,z)}else{x.insertBefore(l(y),z);n.remove(y)}}return true}else{if(g(y)){if(x.nodeName=="LI"){n.insertAfter(y,x)}else{if(c(x)){n.insertAfter(y,z)}else{n.insertAfter(l(y),z);n.remove(y)}}return true}else{if(x.nodeName=="LI"){z=x;B=l(y,"LI")}else{if(c(x)){B=l(y,"LI")}else{B=l(y)}}o(z,y,B);h(z.parentNode);return true}}}return false}function j(x){var z,y;function A(D,C){var B;if(c(D)){while((B=x.lastChild.firstChild)){C.appendChild(B)}n.remove(D)}}z=x.previousSibling;if(z&&c(z)){z.appendChild(x);return true}if(z&&z.nodeName=="LI"&&c(z.lastChild)){z.lastChild.appendChild(x);A(x.lastChild,z.lastChild);return true}z=x.nextSibling;if(z&&c(z)){z.insertBefore(x,z.firstChild);return true}if(z&&z.nodeName=="LI"&&c(x.lastChild)){return false}z=x.previousSibling;if(z&&z.nodeName=="LI"){y=n.create(x.parentNode.nodeName);z.appendChild(y);y.appendChild(x);A(x.lastChild,y);return true}return false}function i(){var y=p();if(y.length){var z=u(v.getRng(true));for(var x=0;x<y.length;x++){if(!j(y[x])&&x===0){break}}t(z);e.nodeChanged();return true}}function q(){var A=p();if(A.length){var B=u(v.getRng(true));var z,D,x=e.getBody();z=A.length;while(z--){var C=A[z].parentNode;while(C&&C!=x){D=A.length;while(D--){if(A[D]===C){A.splice(z,1);break}}C=C.parentNode}}for(z=0;z<A.length;z++){if(!s(A[z])&&z===0){break}}t(B);e.nodeChanged();return true}}function k(z){var y=v.getRng(true),A=u(y);function x(){var H=[],D=e.getBody();function F(M){var K,L;K=y[M?"startContainer":"endContainer"];L=y[M?"startOffset":"endOffset"];if(K.nodeType==1){K=K.childNodes[Math.min(L,K.childNodes.length-1)]||K}while(K.parentNode!=D){if(f(K)){return K}if(/^(TD|TH)$/.test(K.parentNode.nodeName)){return K}K=K.parentNode}return K}var E=F(true);var C=F();var J,I=[];for(var G=E;G;G=G.nextSibling){I.push(G);if(G==C){break}}tinymce.each(I,function(K){if(f(K)){H.push(K);J=null;return}if(n.isBlock(K)||K.nodeName=="BR"){if(K.nodeName=="BR"){n.remove(K)}J=null;return}var L=K.nextSibling;if(b(K)){if(f(L)||(!L&&K.parentNode==D)){J=null;return}}if(!J){J=n.create("p");K.parentNode.insertBefore(J,K);H.push(J)}J.appendChild(K)});return H}var B=x();tinymce.each(B,function(E){var C,D;D=E.previousSibling;if(D&&c(D)&&D.nodeName==z){C=D;E=n.rename(E,"LI");D.appendChild(E)}else{C=n.create(z);E.parentNode.insertBefore(C,E);C.appendChild(E);E=n.rename(E,"LI")}w(C)});t(A)}function r(){var y=u(v.getRng(true)),x=e.getBody();tinymce.each(p(),function(z){var B,A;if(n.isEmpty(z)){s(z);return}for(B=z;B&&B!=x;B=B.parentNode){if(c(B)){A=B}}o(A,z)});t(y)}function m(y){var x=n.getParent(v.getStart(),"OL,UL");if(x){if(x.nodeName==y){r(y)}else{var z=u(v.getRng(true));w(n.rename(x,y));t(z)}}else{k(y)}}a.backspaceDelete=function(B){function C(E,G){var F=E.startContainer,I=E.startOffset;if(F.nodeType==3&&(G?I<F.data.length:I>0)){return F}var H=new tinymce.dom.TreeWalker(E.startContainer);while((F=H[G?"next":"prev"]())){if(F.nodeType==3&&F.data.length>0){return F}}}function D(F,I){var H,G,E=F.parentNode;if(c(I.lastChild)){G=I.lastChild}H=I.lastChild;if(H&&H.nodeName=="BR"&&F.hasChildNodes()){n.remove(H)}while((H=F.firstChild)){I.appendChild(H)}if(G){I.appendChild(G)}n.remove(F);if(n.isEmpty(E)){n.remove(E)}}if(v.isCollapsed()){var x=n.getParent(v.getStart(),"LI");if(x){var z=v.getRng(true);var y=n.getParent(C(z,B),"LI");if(y&&y!=x){var A=u(z);if(B){D(y,x)}else{D(x,y)}t(A);return true}else{if(!y){if(!B&&r(x.parentNode.nodeName)){return true}}}}}};e.addCommand("Indent",function(){if(!i()){return true}});e.addCommand("Outdent",function(){if(!q()){return true}});e.addCommand("InsertUnorderedList",function(){m("UL")});e.addCommand("InsertOrderedList",function(){m("OL")});e.on("keydown",function(x){if(x.keyCode==9&&e.dom.getParent(e.selection.getStart(),"LI")){x.preventDefault();if(x.shiftKey){q()}else{i()}}})});e.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var h=this;e.on("nodechange",function(){var i=e.dom.getParent(e.selection.getNode(),"LI,UL,OL");h.disabled(i&&(i.nodeName!="LI"||d(i)))})}});e.on("keydown",function(h){if(h.keyCode==tinymce.util.VK.BACKSPACE){if(a.backspaceDelete()){h.preventDefault()}}else{if(h.keyCode==tinymce.util.VK.DELETE){if(a.backspaceDelete(true)){h.preventDefault()}}}})});