define("tinymce/tableplugin/CellSelection",["tinymce/tableplugin/TableGrid","tinymce/dom/TreeWalker","tinymce/util/Tools"],function(b,c,a){return function(i){var k=i.dom,f,j,e,g=true;function d(){i.getBody().style.webkitUserSelect="";if(g){i.dom.removeClass(i.dom.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected");g=false}}function h(p){var n,m,o=p.target;if(j&&(f||o!=j)&&(o.nodeName=="TD"||o.nodeName=="TH")){m=k.getParent(o,"table");if(m==e){if(!f){f=new b(i,m);f.setStartCell(j);i.getBody().style.webkitUserSelect="none"}f.setEndCell(o);g=true}n=i.selection.getSel();try{if(n.removeAllRanges){n.removeAllRanges()}else{n.empty()}}catch(l){}p.preventDefault()}}i.on("MouseDown",function(l){if(l.button!=2){d();j=k.getParent(l.target,"td,th");e=k.getParent(j,"table")}});i.on("mouseover",h);i.on("remove",function(){k.unbind(i.getDoc(),"mouseover",h)});i.on("MouseUp",function(){var n,r=i.selection,m,s,q,p,l;function o(t,v){var u=new c(t,t);do{if(t.nodeType==3&&a.trim(t.nodeValue).length!==0){if(v){n.setStart(t,0)}else{n.setEnd(t,t.nodeValue.length)}return}if(t.nodeName=="BR"){if(v){n.setStartBefore(t)}else{n.setEndBefore(t)}return}}while((t=(v?u.next():u.prev())))}if(j){if(f){i.getBody().style.webkitUserSelect=""}m=k.select("td.mce-item-selected,th.mce-item-selected");if(m.length>0){n=k.createRng();q=m[0];l=m[m.length-1];n.setStartBefore(q);n.setEndAfter(q);o(q,1);s=new c(q,k.getParent(m[0],"table"));do{if(q.nodeName=="TD"||q.nodeName=="TH"){if(!k.hasClass(q,"mce-item-selected")){break}p=q}}while((q=s.next()));o(p);r.setRng(n)}i.nodeChanged();j=f=e=null}});i.on("KeyUp",function(){d()});return{clear:d}}});