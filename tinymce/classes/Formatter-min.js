define("tinymce/Formatter",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/util/Tools","tinymce/fmt/Preview"],function(b,c,a,d){return function(ah){var V={},f=ah.dom,x=ah.selection,S=new c(f),g=ah.schema.isValidChild,M=f.isBlock,q=ah.settings.forced_root_block,z=f.nodeIndex,K="\uFEFF",h=/^(src|href|style)$/,ac=false,G=true,U,H,C=f.getContentEditable,L,o;var Y=a.each,af=a.grep,u=a.walk,v=a.extend;function N(ai){if(ai.nodeType){ai=ai.nodeName}return !!ah.schema.getTextBlockElements()[ai.toLowerCase()]}function r(aj,ai){return f.getParents(aj,ai,f.getRoot())}function e(ai){return ai.nodeType===1&&ai.id==="_mce_caret"}function m(){p({alignleft:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},defaultBlock:"div"},{selector:"img",collapsed:false,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:false,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},defaultBlock:"div"},{selector:"img,table",collapsed:false,styles:{"float":"right"}}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:true},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:true},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},wrap_links:false},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},wrap_links:false},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:true,deep:true,onmatch:function(){return true},onformat:function(ak,ai,aj){Y(aj,function(am,al){f.setAttrib(ak,al,am)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q",remove:"all",split:true,expand:false,block_expand:true,deep:true},{selector:"span",attributes:["style","class"],remove:"empty",split:true,expand:false,deep:true},{selector:"*",attributes:["style","class"],split:false,expand:false,deep:true}]});Y("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(ai){p(ai,{block:ai,remove:"all"})});p(ah.settings.formats)}function ab(){ah.addShortcut("ctrl+b","bold_desc","Bold");ah.addShortcut("ctrl+i","italic_desc","Italic");ah.addShortcut("ctrl+u","underline_desc","Underline");for(var ai=1;ai<=6;ai++){ah.addShortcut("ctrl+"+ai,"",["FormatBlock",false,"h"+ai])}ah.addShortcut("ctrl+7","",["FormatBlock",false,"p"]);ah.addShortcut("ctrl+8","",["FormatBlock",false,"div"]);ah.addShortcut("ctrl+9","",["FormatBlock",false,"address"])}function aa(ai){return ai?V[ai]:V}function p(ai,aj){if(ai){if(typeof(ai)!=="string"){Y(ai,function(al,ak){p(ak,al)})}else{aj=aj.length?aj:[aj];Y(aj,function(ak){if(ak.deep===H){ak.deep=!ak.selector}if(ak.split===H){ak.split=!ak.selector||ak.inline}if(ak.remove===H&&ak.selector&&!ak.inline){ak.remove="none"}if(ak.selector&&ak.inline){ak.mixed=true;ak.block_expand=true}if(typeof(ak.classes)==="string"){ak.classes=ak.classes.split(/\s+/)}});V[ai]=aj}}}function l(aj){var ai;ah.dom.getParent(aj,function(ak){ai=ah.dom.getStyle(ak,"text-decoration");return ai&&ai!=="none"});return ai}function Q(ai){var aj;if(ai.nodeType===1&&ai.parentNode&&ai.parentNode.nodeType===1){aj=l(ai.parentNode);if(ah.dom.getStyle(ai,"color")&&aj){ah.dom.setStyle(ai,"text-decoration",aj)}else{if(ah.dom.getStyle(ai,"textdecoration")===aj){ah.dom.setStyle(ai,"text-decoration",null)}}}}function ae(al,ar,an){var ao=aa(al),at=ao[0],aq,aj,ap=!an&&x.isCollapsed();function ai(ax,aw){aw=aw||at;if(ax){if(aw.onformat){aw.onformat(ax,aw,ar,an)}Y(aw.styles,function(az,ay){f.setStyle(ax,ay,w(az,ar))});Y(aw.attributes,function(az,ay){f.setAttrib(ax,ay,w(az,ar))});Y(aw.classes,function(ay){ay=w(ay,ar);if(!f.hasClass(ax,ay)){f.addClass(ax,ay)}})}}function am(){function ay(aE,aC){var aD=new b(aC);for(an=aD.current();an;an=aD.prev()){if(an.childNodes.length>1||an==aE||an.tagName=="BR"){return an}}}var ax=ah.selection.getRng();var aB=ax.startContainer;var aw=ax.endContainer;if(aB!=aw&&ax.endOffset===0){var aA=ay(aB,aw);var az=aA.nodeType==3?aA.length:aA.childNodes.length;ax.setEnd(aA,az)}return ax}function ak(az,aE,aC,aB,ax){var aw=[],ay=-1,aD,aG=-1,aA=-1,aF;Y(az.childNodes,function(aI,aH){if(aI.nodeName==="UL"||aI.nodeName==="OL"){ay=aH;aD=aI;return false}});Y(az.childNodes,function(aI,aH){if(aI.nodeName==="SPAN"&&f.getAttrib(aI,"data-mce-type")=="bookmark"){if(aI.id==aE.id+"_start"){aG=aH}else{if(aI.id==aE.id+"_end"){aA=aH}}}});if(ay<=0||(aG<ay&&aA>ay)){Y(af(az.childNodes),ax);return 0}else{aF=f.clone(aC,ac);Y(af(az.childNodes),function(aI,aH){if((aG<ay&&aH<ay)||(aG>ay&&aH>ay)){aw.push(aI);aI.parentNode.removeChild(aI)}});if(aG<ay){az.insertBefore(aF,aD)}else{if(aG>ay){az.insertBefore(aF,aD.nextSibling)}}aB.push(aF);Y(aw,function(aH){aF.appendChild(aH)});return aF}}function au(ax,az,aC){var aw=[],aB,ay,aA=true;aB=at.inline||at.block;ay=f.create(aB);ai(ay);S.walk(ax,function(aD){var aE;function aF(aG){var aL,aJ,aH,aI,aK;aK=aA;aL=aG.nodeName.toLowerCase();aJ=aG.parentNode.nodeName.toLowerCase();if(aG.nodeType===1&&C(aG)){aK=aA;aA=C(aG)==="true";aI=true}if(j(aL,"br")){aE=0;if(at.block){f.remove(aG)}return}if(at.wrapper&&D(aG,al,ar)){aE=0;return}if(aA&&!aI&&at.block&&!at.wrapper&&N(aL)&&g(aJ,aB)){aG=f.rename(aG,aB);ai(aG);aw.push(aG);aE=0;return}if(at.selector){Y(ao,function(aM){if("collapsed" in aM&&aM.collapsed!==ap){return}if(f.is(aG,aM.selector)&&!e(aG)){ai(aG,aM);aH=true}});if(!at.inline||aH){aE=0;return}}if(aA&&!aI&&g(aB,aL)&&g(aJ,aB)&&!(!aC&&aG.nodeType===3&&aG.nodeValue.length===1&&aG.nodeValue.charCodeAt(0)===65279)&&!e(aG)&&(!at.inline||!M(aG))){if(!aE){aE=f.clone(ay,ac);aG.parentNode.insertBefore(aE,aG);aw.push(aE)}aE.appendChild(aG)}else{if(aL=="li"&&az){aE=ak(aG,az,ay,aw,aF)}else{aE=0;Y(af(aG.childNodes),aF);if(aI){aA=aK}aE=0}}}Y(aD,aF)});if(at.wrap_links===false){Y(aw,function(aD){function aE(aI){var aH,aG,aF;if(aI.nodeName==="A"){aG=f.clone(ay,ac);aw.push(aG);aF=af(aI.childNodes);for(aH=0;aH<aF.length;aH++){aG.appendChild(aF[aH])}aI.appendChild(aG)}Y(af(aI.childNodes),aE)}aE(aD)})}Y(aw,function(aF){var aD;function aG(aI){var aH=0;Y(aI.childNodes,function(aJ){if(!i(aJ)&&!P(aJ)){aH++}});return aH}function aE(aH){var aJ,aI;Y(aH.childNodes,function(aK){if(aK.nodeType==1&&!P(aK)&&!e(aK)){aJ=aK;return ac}});if(aJ&&!P(aJ)&&k(aJ,at)){aI=f.clone(aJ,ac);ai(aI);f.replace(aI,aH,G);f.remove(aJ,1)}return aI||aH}aD=aG(aF);if((aw.length>1||!M(aF))&&aD===0){f.remove(aF,1);return}if(at.inline||at.wrapper){if(!at.exact&&aD===1){aF=aE(aF)}Y(ao,function(aH){Y(f.select(aH.inline,aF),function(aJ){var aI;if(P(aJ)){return}if(aH.wrap_links===false){aI=aJ.parentNode;do{if(aI.nodeName==="A"){return}}while((aI=aI.parentNode))}ag(aH,ar,aJ,aH.exact?aJ:null)})});if(D(aF.parentNode,al,ar)){f.remove(aF,1);aF=0;return G}if(at.merge_with_parents){f.getParent(aF.parentNode,function(aH){if(D(aH,al,ar)){f.remove(aF,1);aF=0;return G}})}if(aF&&at.merge_siblings!==false){aF=A(I(aF),aF);aF=A(aF,I(aF,G))}}})}if(at){if(an){if(an.nodeType){aj=f.createRng();aj.setStartBefore(an);aj.setEndAfter(an);au(t(aj,ao),null,true)}else{au(an,null,true)}}else{if(!ap||!at.inline||f.select("td.mce-item-selected,th.mce-item-selected").length){var av=ah.selection.getNode();if(!q&&ao[0].defaultBlock&&!f.getParent(av,f.isBlock)){ae(ao[0].defaultBlock)}ah.selection.setRng(am());aq=x.getBookmark();au(t(x.getRng(G),ao),aq);if(at.styles&&(at.styles.color||at.styles.textDecoration)){u(av,Q,"childNodes");Q(av)}x.moveToBookmark(aq);W(x.getRng(G));ah.nodeChanged()}else{Z("apply",al,ar)}}}}function F(ak,ar,am){var an=aa(ak),av=an[0],aq,aj,at=true;function al(aA){var az,ay,ax,aC,aB;if(aA.nodeType===1&&C(aA)){aC=at;at=C(aA)==="true";aB=true}az=af(aA.childNodes);if(at&&!aB){for(ay=0,ax=an.length;ay<ax;ay++){if(ag(an[ay],ar,aA,aA)){break}}}if(av.deep){if(az.length){for(ay=0,ax=az.length;ay<ax;ay++){al(az[ay])}if(aB){at=aC}}}}function ao(ax){var ay;Y(r(ax.parentNode).reverse(),function(az){var aA;if(!ay&&az.id!="_start"&&az.id!="_end"){aA=D(az,ak,ar);if(aA&&aA.split!==false){ay=az}}});return ay}function ai(aA,ax,aC,aF){var aG,aE,aD,az,aB,ay;if(aA){ay=aA.parentNode;for(aG=ax.parentNode;aG&&aG!=ay;aG=aG.parentNode){aE=f.clone(aG,ac);for(aB=0;aB<an.length;aB++){if(ag(an[aB],ar,aE,aE)){aE=0;break}}if(aE){if(aD){aE.appendChild(aD)}if(!az){az=aE}aD=aE}}if(aF&&(!av.mixed||!M(aA))){ax=f.split(aA,ax)}if(aD){aC.parentNode.insertBefore(aD,aC);az.appendChild(aC)}}return ax}function au(ax){return ai(ao(ax),ax,ax,true)}function ap(az){var ay=f.get(az?"_start":"_end"),ax=ay[az?"firstChild":"lastChild"];if(P(ax)){ax=ax[az?"firstChild":"lastChild"]}f.remove(ay,true);return ax}function aw(ax){var ay,az;var aA=ax.commonAncestorContainer;ax=t(ax,an,G);if(av.split){ay=R(ax,G);az=R(ax);if(ay!=az){if(/^(TR|TH|TD)$/.test(ay.nodeName)&&ay.firstChild){if(ay.nodeName=="TR"){ay=ay.firstChild.firstChild||ay}else{ay=ay.firstChild||ay}}if(aA&&/^T(HEAD|BODY|FOOT|R)$/.test(aA.nodeName)&&/^(TH|TD)$/.test(az.nodeName)&&az.firstChild){az=az.firstChild||az}ay=X(ay,"span",{id:"_start","data-mce-type":"bookmark"});az=X(az,"span",{id:"_end","data-mce-type":"bookmark"});au(ay);au(az);ay=ap(G);az=ap()}else{ay=az=au(ay)}ax.startContainer=ay.parentNode;ax.startOffset=z(ay);ax.endContainer=az.parentNode;ax.endOffset=z(az)+1}S.walk(ax,function(aB){Y(aB,function(aC){al(aC);if(aC.nodeType===1&&ah.dom.getStyle(aC,"text-decoration")==="underline"&&aC.parentNode&&l(aC.parentNode)==="underline"){ag({deep:false,exact:true,inline:"span",styles:{textDecoration:"underline"}},null,aC)}})})}if(am){if(am.nodeType){aj=f.createRng();aj.setStartBefore(am);aj.setEndAfter(am);aw(aj)}else{aw(am)}return}if(!x.isCollapsed()||!av.inline||f.select("td.mce-item-selected,th.mce-item-selected").length){aq=x.getBookmark();aw(x.getRng(G));x.moveToBookmark(aq);if(av.inline&&n(ak,ar,x.getStart())){W(x.getRng(true))}ah.nodeChanged()}else{Z("remove",ak,ar)}}function J(aj,al,ak){var ai=aa(aj);if(n(aj,al,ak)&&(!("toggle" in ai[0])||ai[0].toggle)){F(aj,al,ak)}else{ae(aj,al,ak)}}function D(aj,ai,ao,am){var ak=aa(ai),ap,an,al;function aq(av,ax,ay){var au,aw,ar=ax[ay],at;if(ax.onmatch){return ax.onmatch(av,ax,ay)}if(ar){if(ar.length===H){for(au in ar){if(ar.hasOwnProperty(au)){if(ay==="attributes"){aw=f.getAttrib(av,au)}else{aw=T(av,au)}if(am&&!aw&&!ax.exact){return}if((!am||ax.exact)&&!j(aw,y(w(ar[au],ao),au))){return}}}}else{for(at=0;at<ar.length;at++){if(ay==="attributes"?f.getAttrib(av,ar[at]):T(av,ar[at])){return ax}}}}return ax}if(ak&&aj){for(an=0;an<ak.length;an++){ap=ak[an];if(k(aj,ap)&&aq(aj,ap,"attributes")&&aq(aj,ap,"styles")){if((al=ap.classes)){for(an=0;an<al.length;an++){if(!f.hasClass(aj,al[an])){return}}}return ap}}}}function n(ak,am,al){var aj;function ai(ao){var an=f.getRoot();if(ao===an){return false}ao=f.getParent(ao,function(ap){return ap.parentNode===an||!!D(ap,ak,am,true)});return D(ao,ak,am)}if(al){return ai(al)}al=x.getNode();if(ai(al)){return G}aj=x.getStart();if(aj!=al){if(ai(aj)){return G}}return ac}function B(am,al){var aj,ak=[],ai={};aj=x.getStart();f.getParent(aj,function(ap){var ao,an;for(ao=0;ao<am.length;ao++){an=am[ao];if(!ai[an]&&D(ap,an,al)){ai[an]=true;ak.push(an)}}},f.getRoot());return ak}function E(am){var ao=aa(am),al,ak,an,aj,ai;if(ao){al=x.getStart();ak=r(al);for(aj=ao.length-1;aj>=0;aj--){ai=ao[aj].selector;if(!ai||ao[aj].defaultBlock){return G}for(an=ak.length-1;an>=0;an--){if(f.is(ak[an],ai)){return G}}}}return ac}function O(ai,al,aj){var ak;if(!U){U={};ak={};ah.on("NodeChange",function(an){var am=r(an.element),ao={};Y(U,function(ap,aq){Y(am,function(ar){if(D(ar,aq,{},ap.similar)){if(!ak[aq]){Y(ap,function(at){at(true,{node:ar,format:aq,parents:am})});ak[aq]=ap}ao[aq]=ap;return false}})});Y(ak,function(ap,aq){if(!ao[aq]){delete ak[aq];Y(ap,function(ar){ar(false,{node:an.element,format:aq,parents:am})})}})})}Y(ai.split(","),function(am){if(!U[am]){U[am]=[];U[am].similar=aj}U[am].push(al)});return this}function ad(ai){return d.getCssText(ah,ai)}v(this,{get:aa,register:p,apply:ae,remove:F,toggle:J,match:n,matchAll:B,matchNode:D,canApply:E,formatChanged:O,getCssText:ad});m();ab();ah.on("BeforeGetContent",function(){if(o){o()}});ah.on("mouseup keydown",function(ai){if(L){L(ai)}});function k(ai,aj){if(j(ai,aj.inline)){return G}if(j(ai,aj.block)){return G}if(aj.selector){return ai.nodeType==1&&f.is(ai,aj.selector)}}function j(aj,ai){aj=aj||"";ai=ai||"";aj=""+(aj.nodeName||aj);ai=""+(ai.nodeName||ai);return aj.toLowerCase()==ai.toLowerCase()}function T(aj,ai){return y(f.getStyle(aj,ai),ai)}function y(aj,ai){if(ai=="color"||ai=="backgroundColor"){aj=f.toHex(aj)}if(ai=="fontWeight"&&aj==700){aj="bold"}if(ai=="fontFamily"){aj=aj.replace(/[\'\"]/g,"").replace(/,\s+/g,",")}return""+aj}function w(ai,aj){if(typeof(ai)!="string"){ai=ai(aj)}else{if(aj){ai=ai.replace(/%(\w+)/g,function(al,ak){return aj[ak]||al})}}return ai}function i(ai){return ai&&ai.nodeType===3&&/^([\t \r\n]+|)$/.test(ai.nodeValue)}function X(ak,aj,ai){var al=f.create(aj,ai);ak.parentNode.insertBefore(al,ak);al.appendChild(ak);return al}function t(ai,au,al){var av,ao,at,ak=ai.startContainer,ap=ai.startOffset,ay=ai.endContainer,ar=ai.endOffset;function aw(aF){var aA,aD,aC,aB,az;aA=aD=aF?ak:ay;aB=aF?"previousSibling":"nextSibling";az=f.getRoot();function aE(aG){return aG.nodeName=="BR"&&aG.getAttribute("data-mce-bogus")&&!aG.nextSibling}if(aA.nodeType==3&&!i(aA)){if(aF?ap>0:ar<aA.nodeValue.length){return aA}}while(true){if(!au[0].block_expand&&M(aD)){return aD}for(aC=aD[aB];aC;aC=aC[aB]){if(!P(aC)&&!i(aC)&&!aE(aC)){return aD}}if(aD.parentNode==az){aA=aD;break}aD=aD.parentNode}return aA}function an(az,aA){if(aA===H){aA=az.nodeType===3?az.length:az.childNodes.length}while(az&&az.hasChildNodes()){az=az.childNodes[aA];if(az){aA=az.nodeType===3?az.length:az.childNodes.length}}return{node:az,offset:aA}}if(ak.nodeType==1&&ak.hasChildNodes()){av=ak.childNodes.length-1;ak=ak.childNodes[ap>av?av:ap];if(ak.nodeType==3){ap=0}}if(ay.nodeType==1&&ay.hasChildNodes()){av=ay.childNodes.length-1;ay=ay.childNodes[ar>av?av:ar-1];if(ay.nodeType==3){ar=ay.nodeValue.length}}function ax(aA){var az=aA;while(az){if(az.nodeType===1&&C(az)){return C(az)==="false"?az:aA}az=az.parentNode}return aA}function aq(aA,aE,aG){var aD,aB,aF,az;function aC(aI,aK){var aL,aH,aJ=aI.nodeValue;if(typeof(aK)=="undefined"){aK=aG?aJ.length:0}if(aG){aL=aJ.lastIndexOf(" ",aK);aH=aJ.lastIndexOf("\u00a0",aK);aL=aL>aH?aL:aH;if(aL!==-1&&!al){aL++}}else{aL=aJ.indexOf(" ",aK);aH=aJ.indexOf("\u00a0",aK);aL=aL!==-1&&(aH===-1||aL<aH)?aL:aH}return aL}if(aA.nodeType===3){aF=aC(aA,aE);if(aF!==-1){return{container:aA,offset:aF}}az=aA}aD=new b(aA,f.getParent(aA,M)||ah.getBody());while((aB=aD[aG?"prev":"next"]())){if(aB.nodeType===3){az=aB;aF=aC(aB);if(aF!==-1){return{container:aB,offset:aF}}}else{if(M(aB)){break}}}if(az){if(aG){aE=0}else{aE=az.length}return{container:az,offset:aE}}}function am(aA,az){var aB,aC,aE,aD;if(aA.nodeType==3&&aA.nodeValue.length===0&&aA[az]){aA=aA[az]}aB=r(aA);for(aC=0;aC<aB.length;aC++){for(aE=0;aE<au.length;aE++){aD=au[aE];if("collapsed" in aD&&aD.collapsed!==ai.collapsed){continue}if(f.is(aB[aC],aD.selector)){return aB[aC]}}}return aA}function aj(aB,az){var aC,aA=f.getRoot();if(!au[0].wrapper){aC=f.getParent(aB,au[0].block,aA)}if(!aC){aC=f.getParent(aB.nodeType==3?aB.parentNode:aB,function(aD){return aD!=aA&&N(aD)})}if(aC&&au[0].wrapper){aC=r(aC,"ul,ol").reverse()[0]||aC}if(!aC){aC=aB;while(aC[az]&&!M(aC[az])){aC=aC[az];if(j(aC,"br")){break}}}return aC||aB}ak=ax(ak);ay=ax(ay);if(P(ak.parentNode)||P(ak)){ak=P(ak)?ak:ak.parentNode;ak=ak.nextSibling||ak;if(ak.nodeType==3){ap=0}}if(P(ay.parentNode)||P(ay)){ay=P(ay)?ay:ay.parentNode;ay=ay.previousSibling||ay;if(ay.nodeType==3){ar=ay.length}}if(au[0].inline){if(ai.collapsed){at=aq(ak,ap,true);if(at){ak=at.container;ap=at.offset}at=aq(ay,ar);if(at){ay=at.container;ar=at.offset}}ao=an(ay,ar);if(ao.node){while(ao.node&&ao.offset===0&&ao.node.previousSibling){ao=an(ao.node.previousSibling)}if(ao.node&&ao.offset>0&&ao.node.nodeType===3&&ao.node.nodeValue.charAt(ao.offset-1)===" "){if(ao.offset>1){ay=ao.node;ay.splitText(ao.offset-1)}}}}if(au[0].inline||au[0].block_expand){if(!au[0].inline||(ak.nodeType!=3||ap===0)){ak=aw(true)}if(!au[0].inline||(ay.nodeType!=3||ar===ay.nodeValue.length)){ay=aw()}}if(au[0].selector&&au[0].expand!==ac&&!au[0].inline){ak=am(ak,"previousSibling");ay=am(ay,"nextSibling")}if(au[0].block||au[0].selector){ak=aj(ak,"previousSibling");ay=aj(ay,"nextSibling");if(au[0].block){if(!M(ak)){ak=aw(true)}if(!M(ay)){ay=aw()}}}if(ak.nodeType==1){ap=z(ak);ak=ak.parentNode}if(ay.nodeType==1){ar=z(ay)+1;ay=ay.parentNode}return{startContainer:ak,startOffset:ap,endContainer:ay,endOffset:ar}}function ag(ao,an,al,ai){var ak,aj,am;if(!k(al,ao)){return ac}if(ao.remove!="all"){Y(ao.styles,function(aq,ap){aq=y(w(aq,an),ap);if(typeof(ap)==="number"){ap=aq;ai=0}if(!ai||j(T(ai,ap),aq)){f.setStyle(al,ap,"")}am=1});if(am&&f.getAttrib(al,"style")===""){al.removeAttribute("style");al.removeAttribute("data-mce-style")}Y(ao.attributes,function(ar,ap){var aq;ar=w(ar,an);if(typeof(ap)==="number"){ap=ar;ai=0}if(!ai||j(f.getAttrib(ai,ap),ar)){if(ap=="class"){ar=f.getAttrib(al,ap);if(ar){aq="";Y(ar.split(/\s+/),function(at){if(/mce\w+/.test(at)){aq+=(aq?" ":"")+at}});if(aq){f.setAttrib(al,ap,aq);return}}}if(ap=="class"){al.removeAttribute("className")}if(h.test(ap)){al.removeAttribute("data-mce-"+ap)}al.removeAttribute(ap)}});Y(ao.classes,function(ap){ap=w(ap,an);if(!ai||f.hasClass(ai,ap)){f.removeClass(al,ap)}});aj=f.getAttribs(al);for(ak=0;ak<aj.length;ak++){if(aj[ak].nodeName.indexOf("_")!==0){return ac}}}if(ao.remove!="none"){s(al,ao);return G}}function s(ak,al){var ai=ak.parentNode,aj;function am(ao,an,ap){ao=I(ao,an,ap);return !ao||(ao.nodeName=="BR"||M(ao))}if(al.block){if(!q){if(M(ak)&&!M(ai)){if(!am(ak,ac)&&!am(ak.firstChild,G,1)){ak.insertBefore(f.create("br"),ak.firstChild)}if(!am(ak,G)&&!am(ak.lastChild,ac,1)){ak.appendChild(f.create("br"))}}}else{if(ai==f.getRoot()){if(!al.list_block||!j(ak,al.list_block)){Y(af(ak.childNodes),function(an){if(g(q,an.nodeName.toLowerCase())){if(!aj){aj=X(an,q);f.setAttribs(aj,ah.settings.forced_root_block_attrs)}else{aj.appendChild(an)}}else{aj=0}})}}}}if(al.selector&&al.inline&&!j(al.inline,ak)){return}f.remove(ak,1)}function I(aj,ai,ak){if(aj){ai=ai?"nextSibling":"previousSibling";for(aj=ak?aj:aj[ai];aj;aj=aj[ai]){if(aj.nodeType==1||!i(aj)){return aj}}}}function P(ai){return ai&&ai.nodeType==1&&ai.getAttribute("data-mce-type")=="bookmark"}function A(al,ak){var aj,ai;function an(aq,ap){if(aq.nodeName!=ap.nodeName){return ac}function ao(at){var au={};Y(f.getAttribs(at),function(av){var aw=av.nodeName.toLowerCase();if(aw.indexOf("_")!==0&&aw!=="style"&&aw!=="data-mce-style"){au[aw]=f.getAttrib(at,aw)}});return au}function ar(aw,av){var au,at;for(at in aw){if(aw.hasOwnProperty(at)){au=av[at];if(au===H){return ac}if(aw[at]!=au){return ac}delete av[at]}}for(at in av){if(av.hasOwnProperty(at)){return ac}}return G}if(!ar(ao(aq),ao(ap))){return ac}if(!ar(f.parseStyle(f.getAttrib(aq,"style")),f.parseStyle(f.getAttrib(ap,"style")))){return ac}return !P(aq)&&!P(ap)}function am(ap,ao){for(aj=ap;aj;aj=aj[ao]){if(aj.nodeType==3&&aj.nodeValue.length!==0){return ap}if(aj.nodeType==1&&!P(aj)){return aj}}return ap}if(al&&ak){al=am(al,"previousSibling");ak=am(ak,"nextSibling");if(an(al,ak)){for(aj=al.nextSibling;aj&&aj!=ak;){ai=aj;aj=aj.nextSibling;al.appendChild(ai)}f.remove(ak);Y(af(ak.childNodes),function(ao){al.appendChild(ao)});return al}}return ak}function R(aj,am){var ai,al,ak;ai=aj[am?"startContainer":"endContainer"];al=aj[am?"startOffset":"endOffset"];if(ai.nodeType==1){ak=ai.childNodes.length-1;if(!am&&al){al--}ai=ai.childNodes[al>ak?ak:al]}if(ai.nodeType===3&&am&&al>=ai.nodeValue.length){ai=new b(ai,ah.getBody()).next()||ai}if(ai.nodeType===3&&!am&&al===0){ai=new b(ai,ah.getBody()).prev()||ai}return ai}function Z(ar,ai,ap){var at="_mce_caret",aj=ah.settings.caret_debug;function ak(ax){var aw=f.create("span",{id:at,"data-mce-bogus":true,style:aj?"color:red":""});if(ax){aw.appendChild(ah.getDoc().createTextNode(K))}return aw}function aq(ax,aw){while(ax){if((ax.nodeType===3&&ax.nodeValue!==K)||ax.childNodes.length>1){return false}if(aw&&ax.nodeType===1){aw.push(ax)}ax=ax.firstChild}return true}function an(aw){while(aw){if(aw.id===at){return aw}aw=aw.parentNode}}function am(aw){var ax;if(aw){ax=new b(aw,aw);for(aw=ax.current();aw;aw=ax.next()){if(aw.nodeType===3){return aw}}}}function al(ay,ax){var az,aw;if(!ay){ay=an(x.getStart());if(!ay){while((ay=f.get(at))){al(ay,false)}}}else{aw=x.getRng(true);if(aq(ay)){if(ax!==false){aw.setStartBefore(ay);aw.setEndBefore(ay)}f.remove(ay)}else{az=am(ay);if(az.nodeValue.charAt(0)===K){az=az.deleteData(0,1)}f.remove(ay,1)}x.setRng(aw)}}function ao(){var ay,aw,aC,aB,az,ax,aA;ay=x.getRng(true);aB=ay.startOffset;ax=ay.startContainer;aA=ax.nodeValue;aw=an(x.getStart());if(aw){aC=am(aw)}if(aA&&aB>0&&aB<aA.length&&/\w/.test(aA.charAt(aB))&&/\w/.test(aA.charAt(aB-1))){az=x.getBookmark();ay.collapse(true);ay=t(ay,aa(ai));ay=S.split(ay);ae(ai,ap,ay);x.moveToBookmark(az)}else{if(!aw||aC.nodeValue!==K){aw=ak(true);aC=aw.firstChild;ay.insertNode(aw);aB=1;ae(ai,ap,aw)}else{ae(ai,ap,aw)}x.setCursorLocation(aC,aB)}}function au(){var aw=x.getRng(true),ax,aA,aD,aC,ay,aG,aF=[],aB,aE;ax=aw.startContainer;aA=aw.startOffset;ay=ax;if(ax.nodeType==3){if(aA!=ax.nodeValue.length||ax.nodeValue===K){aC=true}ay=ay.parentNode}while(ay){if(D(ay,ai,ap)){aG=ay;break}if(ay.nextSibling){aC=true}aF.push(ay);ay=ay.parentNode}if(!aG){return}if(aC){aD=x.getBookmark();aw.collapse(true);aw=t(aw,aa(ai),true);aw=S.split(aw);F(ai,ap,aw);x.moveToBookmark(aD)}else{aE=ak();ay=aE;for(aB=aF.length-1;aB>=0;aB--){ay.appendChild(f.clone(aF[aB],false));ay=ay.firstChild}ay.appendChild(f.doc.createTextNode(K));ay=ay.firstChild;var az=f.getParent(aG,N);if(az&&f.isEmpty(az)){aG.parentNode.replaceChild(aE,aG)}else{f.insertAfter(aE,aG)}x.setCursorLocation(ay,1);if(f.isEmpty(aG)){f.remove(aG)}}}function av(){var aw;aw=an(x.getStart());if(aw&&!f.isEmpty(aw)){u(aw,function(ax){if(ax.nodeType==1&&ax.id!==at&&!f.isEmpty(ax)){f.setAttrib(ax,"data-mce-bogus",null)}},"childNodes")}}if(!ah._hasCaretEvents){o=function(){var aw=[],ax;if(aq(an(x.getStart()),aw)){ax=aw.length;while(ax--){f.setAttrib(aw[ax],"data-mce-bogus","1")}}};L=function(ax){var aw=ax.keyCode;al();if(aw==8||aw==37||aw==39){al(an(x.getStart()))}av()};ah.on("SetContent",function(aw){if(aw.selection){av()}});ah._hasCaretEvents=true}if(ar=="apply"){ao()}else{au()}}function W(aj){var ai=aj.startContainer,ap=aj.startOffset,al,ao,an,ak,am;if(ai.nodeType==3&&ap>=ai.nodeValue.length){ap=z(ai);ai=ai.parentNode;al=true}if(ai.nodeType==1){ak=ai.childNodes;ai=ak[Math.min(ap,ak.length-1)];ao=new b(ai,f.getParent(ai,f.isBlock));if(ap>ak.length-1||al){ao.next()}for(an=ao.current();an;an=ao.next()){if(an.nodeType==3&&!i(an)){am=f.create("a",null,K);an.parentNode.insertBefore(am,an);aj.setStart(an,0);x.setRng(aj);f.remove(am);return}}}}}});