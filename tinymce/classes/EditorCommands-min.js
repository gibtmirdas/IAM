define("tinymce/EditorCommands",["tinymce/html/Serializer","tinymce/Env","tinymce/util/Tools"],function(i,g,d){var k=d.each,h=d.extend;var b=d.map,l=d.inArray,j=d.explode;var a=g.gecko,c=g.ie;var e=true,f=false;return function(u){var t=u.dom,w=u.selection,q={state:{},exec:{},value:{}},r=u.settings,x=u.formatter,v;function y(F,E,D){var C;F=F.toLowerCase();if((C=q.exec[F])){C(F,E,D);return e}return f}function s(D){var C;D=D.toLowerCase();if((C=q.state[D])){return C(D)}return -1}function o(D){var C;D=D.toLowerCase();if((C=q.value[D])){return C(D)}return f}function B(C,D){D=D||"exec";k(C,function(F,E){k(E.toLowerCase().split(","),function(G){q[D][G]=F})})}h(this,{execCommand:y,queryCommandState:s,queryCommandValue:o,addCommands:B});function m(E,D,C){if(D===undefined){D=f}if(C===undefined){C=null}return u.getDoc().execCommand(E,D,C)}function A(C){return x.match(C)}function z(C,D){x.toggle(C,D?{value:D}:undefined);u.nodeChanged()}function p(C){v=w.getBookmark(C)}function n(){w.moveToBookmark(v)}B({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){u.undoManager.add()},"Cut,Copy,Paste":function(G){var E=u.getDoc(),C;try{m(G)}catch(D){C=e}if(C||!E.queryCommandSupported(G)){var F=u.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");if(g.mac){F=F.replace(/Ctrl\+/g,"\u2318+")}u.windowManager.alert(F)}},unlink:function(){if(w.isCollapsed()){var C=w.getNode();if(C.tagName=="A"){u.dom.remove(C,true)}return}x.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(C){var D=C.substring(7);if(D=="full"){D="justify"}k("left,center,right,justify".split(","),function(E){if(D!=E){x.remove("align"+E)}});z("align"+D);y("mceRepaint")},"InsertUnorderedList,InsertOrderedList":function(E){var C,D;m(E);C=t.getParent(w.getNode(),"ol,ul");if(C){D=C.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(D.nodeName)){p();t.split(D,C);n()}}},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(C){z(C)},"ForeColor,HiliteColor,FontName":function(E,D,C){z(E,C)},FontSize:function(F,E,D){var C,G;if(D>=1&&D<=7){G=j(r.font_size_style_values);C=j(r.font_size_classes);if(C){D=C[D-1]||D}else{D=G[D-1]||D}}z(F,D)},RemoveFormat:function(C){x.remove(C)},mceBlockQuote:function(){z("blockquote")},FormatBlock:function(E,D,C){return z(C||"p")},mceCleanup:function(){var C=w.getBookmark();u.setContent(u.getContent({cleanup:e}),{cleanup:e});w.moveToBookmark(C)},mceRemoveNode:function(F,E,D){var C=D||w.getNode();if(C!=u.getBody()){p();u.dom.remove(C,e);n()}},mceSelectNodeDepth:function(F,E,D){var C=0;t.getParent(w.getNode(),function(G){if(G.nodeType==1&&C++==D){w.select(G);return f}},u.getBody())},mceSelectNode:function(E,D,C){w.select(C)},mceInsertContent:function(G,O,P){var F,S,J,T,D,E;var I,H,Q,C,K;function R(X){var W,V,Y;W=w.getRng(true);V=W.startContainer;Y=W.startOffset;function U(Z){return V[Z]&&V[Z].nodeType==3}if(V.nodeType==3){if(Y>0){X=X.replace(/^&nbsp;/," ")}else{if(!U("previousSibling")){X=X.replace(/^ /,"&nbsp;")}}if(Y<V.length){X=X.replace(/&nbsp;(<br>|)$/," ")}else{if(!U("nextSibling")){X=X.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;")}}}return X}if(/^ | $/.test(P)){P=R(P)}F=u.parser;S=new i({},u.schema);K='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#200B;</span>';E={content:P,format:"html",selection:true};u.fire("BeforeSetContent",E);P=E.content;if(P.indexOf("{$caret}")==-1){P+="{$caret}"}P=P.replace(/\{\$caret\}/,K);H=w.getRng();var N=H.startContainer||(H.parentElement?H.parentElement():null);var L=u.getBody();if(N===L&&w.isCollapsed()){if(t.isBlock(L.firstChild)&&t.isEmpty(L.firstChild)){H=t.createRng();H.setStart(L.firstChild,0);H.setEnd(L.firstChild,0);w.setRng(H)}}if(!w.isCollapsed()){u.getDoc().execCommand("Delete",false,null)}J=w.getNode();var M={context:J.nodeName.toLowerCase()};D=F.parse(P,M);Q=D.lastChild;if(Q.attr("id")=="mce_marker"){I=Q;for(Q=Q.prev;Q;Q=Q.walk(true)){if(Q.type==3||!t.isBlock(Q.name)){Q.parent.insert(I,Q,Q.name==="br");break}}}if(!M.invalid){P=S.serialize(D);Q=J.firstChild;C=J.lastChild;if(!Q||(Q===C&&Q.nodeName==="BR")){t.setHTML(J,P)}else{w.setContent(P)}}else{w.setContent(K);J=w.getNode();T=u.getBody();if(J.nodeType==9){J=Q=T}else{Q=J}while(Q!==T){J=Q;Q=Q.parentNode}P=J==T?T.innerHTML:t.getOuterHTML(J);P=S.serialize(F.parse(P.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return S.serialize(D)})));if(J==T){t.setHTML(T,P)}else{t.setOuterHTML(J,P)}}I=t.get("mce_marker");w.scrollIntoView(I);H=t.createRng();Q=I.previousSibling;if(Q&&Q.nodeType==3){H.setStart(Q,Q.nodeValue.length);if(!c){C=I.nextSibling;if(C&&C.nodeType==3){Q.appendData(C.data);C.parentNode.removeChild(C)}}}else{H.setStartBefore(I);H.setEndBefore(I)}t.remove(I);w.setRng(H);u.fire("SetContent",E);u.addVisual()},mceInsertRawHTML:function(E,D,C){w.setContent("tiny_mce_marker");u.setContent(u.getContent().replace(/tiny_mce_marker/g,function(){return C}))},mceToggleFormat:function(E,D,C){z(C)},mceSetContent:function(E,D,C){u.setContent(C)},"Indent,Outdent":function(F){var D,C,E;D=r.indentation;C=/[a-z%]+$/i.exec(D);D=parseInt(D,10);if(!s("InsertUnorderedList")&&!s("InsertOrderedList")){if(!r.forced_root_block&&!t.getParent(w.getNode(),t.isBlock)){x.apply("div")}k(w.getSelectedBlocks(),function(H){if(H.nodeName!="LI"){var G=u.getParam("indent_use_margin",false)?"margin":"padding";G+=t.getStyle(H,"direction",true)=="rtl"?"Right":"Left";if(F=="outdent"){E=Math.max(0,parseInt(H.style[G]||0,10)-D);t.setStyle(H,G,E?E+C:"")}else{E=(parseInt(H.style[G]||0,10)+D)+C;t.setStyle(H,G,E)}}})}else{m(F)}},mceRepaint:function(){if(a){try{p(e);if(w.getSel()){w.getSel().selectAllChildren(u.getBody())}w.collapse(e);n()}catch(C){}}},InsertHorizontalRule:function(){u.execCommand("mceInsertContent",false,"<hr />")},mceToggleVisualAid:function(){u.hasVisual=!u.hasVisual;u.addVisual()},mceReplaceContent:function(E,D,C){u.execCommand("mceInsertContent",false,C.replace(/\{\$selection\}/g,w.getContent({format:"text"})))},mceInsertLink:function(F,E,D){var C;if(typeof(D)=="string"){D={href:D}}C=t.getParent(w.getNode(),"a");D.href=D.href.replace(" ","%20");if(!C||!D.href){x.remove("link")}if(D.href){x.apply("link",D,C)}},selectAll:function(){var D=t.getRoot(),C;if(w.getRng().setStart){C=t.createRng();C.setStart(D,0);C.setEnd(D,D.childNodes.length);w.setRng(C)}else{C=w.getRng();if(!C.item){C.moveToElementText(D);C.select()}}},"delete":function(){m("Delete");var C=u.getBody();if(t.isEmpty(C)){u.setContent("");if(C.firstChild&&t.isBlock(C.firstChild)){u.selection.setCursorLocation(C.firstChild,0)}else{u.selection.setCursorLocation(C,0)}}},mceNewDocument:function(){u.setContent("")}});B({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(F){var D="align"+F.substring(7);var C=w.isCollapsed()?[t.getParent(w.getNode(),t.isBlock)]:w.getSelectedBlocks();var E=b(C,function(G){return !!x.matchNode(G,D)});return l(E,e)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(C){return A(C)},mceBlockQuote:function(){return A("blockquote")},Outdent:function(){var C;if(r.inline_styles){if((C=t.getParent(w.getStart(),t.isBlock))&&parseInt(C.style.paddingLeft,10)>0){return e}if((C=t.getParent(w.getEnd(),t.isBlock))&&parseInt(C.style.paddingLeft,10)>0){return e}}return(s("InsertUnorderedList")||s("InsertOrderedList")||(!r.inline_styles&&!!t.getParent(w.getNode(),"BLOCKQUOTE")))},"InsertUnorderedList,InsertOrderedList":function(D){var C=t.getParent(w.getNode(),"ul,ol");return C&&(D==="insertunorderedlist"&&C.tagName==="UL"||D==="insertorderedlist"&&C.tagName==="OL")}},"state");B({"FontSize,FontName":function(E){var D=0,C;if((C=t.getParent(w.getNode(),"span"))){if(E=="fontsize"){D=C.style.fontSize}else{D=C.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()}}return D}},"value");B({Undo:function(){u.undoManager.undo()},Redo:function(){u.undoManager.redo()}})}});