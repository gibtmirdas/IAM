define("tinymce/dom/ControlSelection",["tinymce/util/VK","tinymce/util/Tools","tinymce/Env"],function(c,b,a){return function(p,e){var f=e.dom,G=b.each;var m,O,D,M,K;var t,r,A,z,u,x,E,i;var d,g,n=e.getDoc(),L=document,l=a.ie&&a.ie<11;D={n:[0.5,0,0,-1],e:[1,0.5,1,0],s:[0.5,1,0,1],w:[0,0.5,-1,0],nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var s=".mce-content-body";e.contentStyles.push(s+" div.mce-resizehandle {position: absolute;border: 1px solid black;background: #FFF;width: 5px;height: 5px;z-index: 10000}"+s+" .mce-resizehandle:hover {background: #000}"+s+" img[data-mce-selected], hr[data-mce-selected] {outline: 1px solid black;resize: none}"+s+" .mce-clonedresizable {position: absolute;"+(a.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}");function H(Q){var P=e.settings.object_resizing;if(P===false||a.iOS){return false}if(typeof P!="string"){P="table,img,div"}if(Q.getAttribute("data-mce-resize")==="false"){return false}return e.dom.is(Q,P)}function h(R){var Q,P;Q=R.screenX-t;P=R.screenY-r;d=Q*M[2]+u;g=P*M[3]+x;d=d<5?5:d;g=g<5?5:g;if(c.modifierPressed(R)||(m.nodeName=="IMG"&&M[2]*M[3]!==0)){d=Math.round(g/E);g=Math.round(d*E)}f.setStyles(O,{width:d,height:g});if(M[2]<0&&O.clientWidth<=d){f.setStyle(O,"left",A+(u-d))}if(M[3]<0&&O.clientHeight<=g){f.setStyle(O,"top",z+(x-g))}if(!i){e.fire("ObjectResizeStart",{target:m,width:u,height:x});i=true}}function C(){i=false;function P(Q,R){if(R){if(m.style[Q]||!e.schema.isValid(m.nodeName.toLowerCase(),Q)){f.setStyle(m,Q,R)}else{f.setAttrib(m,Q,R)}}}P("width",d);P("height",g);f.unbind(n,"mousemove",h);f.unbind(n,"mouseup",C);if(L!=n){f.unbind(L,"mousemove",h);f.unbind(L,"mouseup",C)}f.remove(O);if(!l||m.nodeName=="TABLE"){y(m)}e.fire("ObjectResized",{target:m,width:d,height:g});e.nodeChanged()}function y(X,U,Q){var R,W,S,T,V,P=e.getBody();N();R=f.getPos(X,P);A=R.x;z=R.y;V=X.getBoundingClientRect();W=V.width||(V.right-V.left);S=V.height||(V.bottom-V.top);if(m!=X){I();m=X;d=g=0}T=e.fire("ObjectSelected",{target:X});if(H(X)&&!T.isDefaultPrevented()){G(D,function(ab,Z){var aa,ac;function Y(ad){t=ad.screenX;r=ad.screenY;u=m.clientWidth;x=m.clientHeight;E=x/u;M=ab;O=m.cloneNode(true);f.addClass(O,"mce-clonedresizable");O.contentEditable=false;O.unSelectabe=true;f.setStyles(O,{left:A,top:z,margin:0});O.removeAttribute("data-mce-selected");e.getBody().appendChild(O);f.bind(n,"mousemove",h);f.bind(n,"mouseup",C);if(L!=n){f.bind(L,"mousemove",h);f.bind(L,"mouseup",C)}}if(U){if(Z==U){Y(Q)}return}aa=f.get("mceResizeHandle"+Z);if(!aa){ac=e.getBody();aa=f.add(ac,"div",{id:"mceResizeHandle"+Z,"data-mce-bogus":true,"class":"mce-resizehandle",unselectable:true,style:"cursor:"+Z+"-resize; margin:0; padding:0"});if(a.ie){aa.contentEditable=false}}else{f.show(aa)}if(!ab.elm){f.bind(aa,"mousedown",function(ad){ad.stopImmediatePropagation();ad.preventDefault();Y(ad)});ab.elm=aa}f.setStyles(aa,{left:(W*ab[0]+A)-(aa.offsetWidth/2),top:(S*ab[1]+z)-(aa.offsetHeight/2)})})}else{v()}m.setAttribute("data-mce-selected","1")}function v(){var P,Q;N();if(m){m.removeAttribute("data-mce-selected")}for(P in D){Q=f.get("mceResizeHandle"+P);if(Q){f.unbind(Q);f.remove(Q)}}}function w(R){var P;function Q(T,S){if(T){do{if(T===S){return true}}while((T=T.parentNode))}}G(f.select("img[data-mce-selected],hr[data-mce-selected]"),function(S){S.removeAttribute("data-mce-selected")});P=R.type=="mousedown"?R.target:p.getNode();P=f.getParent(P,l?"table":"table,img,hr");if(Q(P,e.getBody())){B();if(Q(p.getStart(),P)&&Q(p.getEnd(),P)){if(!l||(P!=p.getStart()&&p.getStart().nodeName!=="IMG")){y(P);return}}}v()}function j(R,P,Q){if(R&&R.attachEvent){R.attachEvent("on"+P,Q)}}function q(R,P,Q){if(R&&R.detachEvent){R.detachEvent("on"+P,Q)}}function o(R){var S=R.srcElement,W,P,X,V,T,U,Q;W=S.getBoundingClientRect();U=K.clientX-W.left;Q=K.clientY-W.top;for(P in D){X=D[P];V=S.offsetWidth*X[0];T=S.offsetHeight*X[1];if(Math.abs(V-U)<8&&Math.abs(T-Q)<8){M=X;break}}i=true;e.getDoc().selection.empty();y(S,P,K)}function J(Q){var P=Q.srcElement;if(P!=m){I();if(P.id.indexOf("mceResizeHandle")===0){Q.returnValue=false;return}if(P.nodeName=="IMG"||P.nodeName=="TABLE"){v();m=P;j(P,"resizestart",o)}}}function I(){q(m,"resizestart",o)}function N(){for(var P in D){var Q=D[P];if(Q.elm){f.unbind(Q.elm);delete Q.elm}}}function B(){try{e.getDoc().execCommand("enableObjectResizing",false,false)}catch(P){}}function k(R){var Q;if(!l){return}Q=n.body.createControlRange();try{Q.addElement(R);Q.select();return true}catch(P){}}e.on("init",function(){if(l){e.on("ObjectResized",function(P){if(P.target.nodeName!="TABLE"){v();k(P.target)}});j(e.getBody(),"controlselect",J);e.on("mousedown",function(P){K=P})}else{B();if(a.ie>=11){e.on("mouseup",function(P){var Q=P.target.nodeName;if(/^(TABLE|IMG|HR)$/.test(Q)){e.selection.select(P.target,Q=="TABLE");e.nodeChanged()}});e.dom.bind(e.getBody(),"mscontrolselect",function(P){if(/^(TABLE|IMG|HR)$/.test(P.target.nodeName)){P.preventDefault();if(P.target.tagName=="IMG"){window.setTimeout(function(){e.selection.select(P.target)},0)}}})}}e.on("nodechange mousedown mouseup ResizeEditor",w);e.on("keydown keyup",function(P){if(m&&m.nodeName=="TABLE"){w(P)}})});e.on("remove",N);function F(){m=O=null;if(l){I();q(e.getBody(),"controlselect",J)}}return{isResizable:H,showResizeRect:y,hideResizeRect:v,updateResizeRect:w,controlSelect:k,destroy:F}}});