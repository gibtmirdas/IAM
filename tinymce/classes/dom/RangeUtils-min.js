define("tinymce/dom/RangeUtils",["tinymce/util/Tools","tinymce/dom/TreeWalker"],function(a,b){var d=a.each;function c(e){this.walk=function(f,u){var k=f.startContainer,n=f.startOffset,v=f.endContainer,o=f.endOffset,l,i,q,j,t,s,g;g=e.select("td.mce-item-selected,th.mce-item-selected");if(g.length>0){d(g,function(w){u([w])});return}function h(w){var x;x=w[0];if(x.nodeType===3&&x===k&&n>=x.nodeValue.length){w.splice(0,1)}x=w[w.length-1];if(o===0&&w.length>0&&x===v&&x.nodeType===3){w.splice(w.length-1,1)}return w}function r(y,x,w){var z=[];for(;y&&y!=w;y=y[x]){z.push(y)}return z}function p(x,w){do{if(x.parentNode==w){return x}x=x.parentNode}while(x)}function m(y,x,z){var w=z?"nextSibling":"previousSibling";for(j=y,t=j.parentNode;j&&j!=x;j=t){t=j.parentNode;s=r(j==y?j:j[w],w);if(s.length){if(!z){s.reverse()}u(h(s))}}}if(k.nodeType==1&&k.hasChildNodes()){k=k.childNodes[n]}if(v.nodeType==1&&v.hasChildNodes()){v=v.childNodes[Math.min(o-1,v.childNodes.length-1)]}if(k==v){return u(h([k]))}l=e.findCommonAncestor(k,v);for(j=k;j;j=j.parentNode){if(j===v){return m(k,l,true)}if(j===l){break}}for(j=v;j;j=j.parentNode){if(j===k){return m(v,l)}if(j===l){break}}i=p(k,l)||k;q=p(v,l)||v;m(k,i,true);s=r(i==k?i:i.nextSibling,"nextSibling",q==v?q.nextSibling:q);if(s.length){u(h(s))}m(v,q)};this.split=function(g){var j=g.startContainer,f=g.startOffset,k=g.endContainer,i=g.endOffset;function h(l,m){return l.splitText(m)}if(j==k&&j.nodeType==3){if(f>0&&f<j.nodeValue.length){k=h(j,f);j=k.previousSibling;if(i>f){i=i-f;j=k=h(k,i).previousSibling;i=k.nodeValue.length;f=0}else{i=0}}}else{if(j.nodeType==3&&f>0&&f<j.nodeValue.length){j=h(j,f);f=0}if(k.nodeType==3&&i>0&&i<k.nodeValue.length){k=h(k,i).previousSibling;i=k.nodeValue.length}}return{startContainer:j,startOffset:f,endContainer:k,endOffset:i}};this.normalize=function(f){var i,h;function g(l){var k,o,j,q=e.getRoot(),m,p;var s,n;function u(v,w){var x=new b(v,e.getParent(v.parentNode,e.isBlock)||q);while((v=x[w?"prev":"next"]())){if(v.nodeName==="BR"){return true}}}function r(w,v){return w.previousSibling&&w.previousSibling.nodeName==v}function t(y,v){var z,w,x;v=v||k;x=e.getParent(v.parentNode,e.isBlock)||q;if(y&&v.nodeName=="BR"&&n&&e.isEmpty(x)){k=v.parentNode;o=e.nodeIndex(v);i=true;return}z=new b(v,x);while((m=z[y?"prev":"next"]())){if(m.nodeType===3&&m.nodeValue.length>0){k=m;o=y?m.nodeValue.length:0;i=true;return}if(e.isBlock(m)||p[m.nodeName.toLowerCase()]){return}w=m}if(h&&w){k=w;i=true;o=0}}k=f[(l?"start":"end")+"Container"];o=f[(l?"start":"end")+"Offset"];n=k.nodeType==1&&o===k.childNodes.length;p=e.schema.getNonEmptyElements();s=l;if(k.nodeType==1&&o>k.childNodes.length-1){s=false}if(k.nodeType===9){k=e.getRoot();o=0}if(k===q){if(s){m=k.childNodes[o>0?o-1:0];if(m){if(p[m.nodeName]||m.nodeName=="TABLE"){return}}}if(k.hasChildNodes()){o=Math.min(!s&&o>0?o-1:o,k.childNodes.length-1);k=k.childNodes[o];o=0;if(k.hasChildNodes()&&!/TABLE/.test(k.nodeName)){m=k;j=new b(k,q);do{if(m.nodeType===3&&m.nodeValue.length>0){o=s?0:m.nodeValue.length;k=m;i=true;break}if(p[m.nodeName.toLowerCase()]){o=e.nodeIndex(m);k=m.parentNode;if(m.nodeName=="IMG"&&!s){o++}i=true;break}}while((m=(s?j.next():j.prev())))}}}if(h){if(k.nodeType===3&&o===0){t(true)}if(k.nodeType===1){m=k.childNodes[o];if(!m){m=k.childNodes[o-1]}if(m&&m.nodeName==="BR"&&!r(m,"A")&&!u(m)&&!u(m,true)){t(true,m)}}}if(s&&!h&&k.nodeType===3&&o===k.nodeValue.length){t(false)}if(i){f["set"+(l?"Start":"End")](k,o)}}h=f.collapsed;g(true);if(!h){g()}if(i&&h){f.collapse(true)}return i}}c.compareRanges=function(f,e){if(f&&e){if(f.item||f.duplicate){if(f.item&&e.item&&f.item(0)===e.item(0)){return true}if(f.isEqual&&e.isEqual&&e.isEqual(f)){return true}}else{return f.startContainer==e.startContainer&&f.startOffset==e.startOffset}}return false};return c});