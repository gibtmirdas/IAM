define("tinymce/ui/MenuButton",["tinymce/ui/Button","tinymce/ui/Factory","tinymce/ui/MenuBar"],function(d,b,c){function a(g,f){while(g){if(f===g){return true}g=g.parentNode}return false}var e=d.extend({init:function(g){var f=this;f._renderOpen=true;f._super(g);f.addClass("menubtn");if(g.fixedWidth){f.addClass("fixed-width")}f.aria("haspopup",true);f.hasPopup=true},showMenu:function(){var f=this,g=f.settings,h;if(f.menu&&f.menu.visible()){return f.hideMenu()}if(!f.menu){h=g.menu||[];if(h.length){h={type:"menu",items:h}}else{h.type=h.type||"menu"}f.menu=b.create(h).parent(f).renderTo();f.fire("createmenu");f.menu.reflow();f.menu.on("cancel",function(i){if(i.control.parent()===f.menu){i.stopPropagation();f.focus();f.hideMenu()}});f.menu.on("select",function(){f.focus()});f.menu.on("show hide",function(i){if(i.control==f.menu){f.activeMenu(i.type=="show")}f.aria("expanded",i.type=="show")}).fire("show")}f.menu.show();f.menu.layoutRect({w:f.layoutRect().w});f.menu.moveRel(f.getEl(),f.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},hideMenu:function(){var f=this;if(f.menu){f.menu.items().each(function(g){if(g.hideMenu){g.hideMenu()}});f.menu.hide()}},activeMenu:function(f){this.toggleClass("active",f)},renderHtml:function(){var f=this,i=f._id,h=f.classPrefix;var g=f.settings.icon?h+"ico "+h+"i-"+f.settings.icon:"";f.aria("role",f.parent() instanceof c?"menuitem":"button");return('<div id="'+i+'" class="'+f.classes()+'" tabindex="-1" aria-labelledby="'+i+'"><button id="'+i+'-open" role="presentation" type="button" tabindex="-1">'+(g?'<i class="'+g+'"></i>':"")+"<span>"+(f._text?(g?"\u00a0":"")+f.encode(f._text):"")+'</span> <i class="'+h+'caret"></i></button></div>')},postRender:function(){var f=this;f.on("click",function(g){if(g.control===f&&a(g.target,f.getEl())){f.showMenu();if(g.aria){f.menu.items()[0].focus()}}});f.on("mouseenter",function(j){var g=j.control,i=f.parent(),h;if(g&&i&&g instanceof e&&g.parent()==i){i.items().filter("MenuButton").each(function(k){if(k.hideMenu&&k!=g){if(k.menu&&k.menu.visible()){h=true}k.hideMenu()}});if(h){g.focus();g.showMenu()}}});return f._super()},text:function(j){var f=this,h,g;if(f._rendered){g=f.getEl("open").getElementsByTagName("span");for(h=0;h<g.length;h++){g[h].innerHTML=(f.settings.icon&&j?"\u00a0":"")+f.encode(j)}}return this._super(j)},remove:function(){this._super();if(this.menu){this.menu.remove()}}});return e});