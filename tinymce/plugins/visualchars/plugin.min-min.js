tinymce.PluginManager.add("visualchars",function(d){function b(p){var q,u,k,e,o,n,j=d.getBody(),h=d.selection;if(g=!g,f.state=g,d.fire("VisualChars",{state:g}),p&&(n=h.getBookmark()),g){for(u=[],tinymce.walk(j,function(a){3==a.nodeType&&a.nodeValue&&-1!=a.nodeValue.indexOf("Â ")&&u.push(a)},"childNodes"),k=0;k<u.length;k++){for(e=u[k].nodeValue,e=e.replace(/(\u00a0)/g,'<span data-mce-bogus="1" class="mce-nbsp">$1</span>'),o=d.dom.create("div",null,e);q=o.lastChild;){d.dom.insertAfter(q,u[k])}d.dom.remove(u[k])}}else{for(u=d.dom.select("span.mce-nbsp",j),k=u.length-1;k>=0;k--){d.dom.remove(u[k],1)}}h.moveToBookmark(n)}function c(){var e=this;d.on("VisualChars",function(a){e.active(a.state)})}var g,f=this;d.addCommand("mceVisualChars",b),d.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:c}),d.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:c,selectable:!0,context:"view",prependToContext:!0}),d.on("beforegetcontent",function(a){g&&"raw"!=a.format&&!a.draft&&(g=!0,b(!1))})});