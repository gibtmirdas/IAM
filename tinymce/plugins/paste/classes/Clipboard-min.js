define("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/util/VK","tinymce/pasteplugin/Utils"],function(a,c,b){return function(h){var o=this,f,r,e=0;var i="%MCEPASTEBIN%",s;function p(x){var w,y=h.dom;w=h.fire("BeforePastePreProcess",{content:x});w=h.fire("PastePreProcess",w);x=w.content;if(!w.isDefaultPrevented()){if(h.hasEventListeners("PastePostProcess")&&!w.isDefaultPrevented()){var v=y.add(h.getBody(),"div",{style:"display:none"},x);w=h.fire("PastePostProcess",{node:v});y.remove(v);x=w.node.innerHTML}if(!w.isDefaultPrevented()){h.insertContent(x)}}}function q(y){y=h.dom.encode(y).replace(/\r\n/g,"\n");var w=h.dom.getParent(h.selection.getStart(),h.dom.isBlock);var v=h.settings.forced_root_block;var x;if(v){x=h.dom.createHTML(v,h.settings.forced_root_block_attrs);x=x.substr(0,x.length-3)+">"}if((w&&/^(PRE|DIV)$/.test(w.nodeName))||!v){y=b.filter(y,[[/\n/g,"<br>"]])}else{y=b.filter(y,[[/\n\n/g,"</p>"+x],[/^(.*<\/p>)(<p>)$/,x+"$1"],[/\n/g,"<br />"]]);if(y.indexOf("<p>")!=-1){y=x+y}}p(y)}function j(){var C=h.dom,w=h.getBody();var v=h.dom.getViewPort(h.getWin()),B=v.y,A=20;var z;r=h.selection.getRng();if(h.inline){z=h.selection.getScrollContainer();if(z){B=z.scrollTop}}if(r.getClientRects){var y=r.getClientRects();if(y.length){A=B+(y[0].top-C.getPos(w).y)}else{A=B;var x=r.startContainer;if(x){if(x.nodeType==3&&x.parentNode!=w){x=x.parentNode}if(x.nodeType==1){A=C.getPos(x,z||w).y}}}}f=C.add(h.getBody(),"div",{id:"mcepastebin",contentEditable:true,"data-mce-bogus":"1",style:"position: absolute; top: "+A+"px;width: 10px; height: 10px; overflow: hidden; opacity: 0"},i);if(a.ie||a.gecko){C.setStyle(f,"left",C.getStyle(w,"direction",true)=="rtl"?65535:-65535)}C.bind(f,"beforedeactivate focusin focusout",function(D){D.stopPropagation()});f.focus();h.selection.select(f,true)}function u(){if(f){var v;while((v=h.dom.get("mcepastebin"))){h.dom.remove(v);h.dom.unbind(v)}if(r){h.selection.setRng(r)}}s=false;f=r=null}function t(){var y=i,w,x;w=h.dom.select("div[id=mcepastebin]");x=w.length;while(x--){var v=w[x].innerHTML;if(y==i){y=""}if(v.length>y.length){y=v}}return y}function l(x){var w={};if(x&&x.types){var z=x.getData("Text");if(z&&z.length>0){w["text/plain"]=z}for(var v=0;v<x.types.length;v++){var y=x.types[v];w[y]=x.getData(y)}}return w}function m(v){return l(v.clipboardData||h.getDoc().dataTransfer)}function k(z,y){function x(B){if(v[w].type=="image/png"){var A=new FileReader();A.onload=function(){p('<img src="'+A.result+'">')};A.readAsDataURL(B.getAsFile());return true}}if(!h.settings.paste_data_images||"text/html" in y||"text/plain" in y){return}if(z.clipboardData){var v=z.clipboardData.items;if(v){for(var w=0;w<v.length;w++){if(x(v[w])){return true}}}}}function d(y){var x=h.getDoc(),w;if(x.caretPositionFromPoint){var v=x.caretPositionFromPoint(y.clientX,y.clientY);w=x.createRange();w.setStart(v.offsetNode,v.offset);w.collapse(true)}else{if(x.caretRangeFromPoint){w=x.caretRangeFromPoint(y.clientX,y.clientY)}}return w}function n(v,w){return w in v&&v[w].length>0}function g(){h.on("keydown",function(v){if(v.isDefaultPrevented()){return}if((c.metaKeyPressed(v)&&v.keyCode==86)||(v.shiftKey&&v.keyCode==45)){s=v.shiftKey&&v.keyCode==86;v.stopImmediatePropagation();e=new Date().getTime();if(a.ie&&s){v.preventDefault();h.fire("paste",{ieFake:true});return}u();j()}});h.on("paste",function(y){var x=m(y);var v=new Date().getTime()-e<1000;var w=o.pasteFormat=="text"||s;if(y.isDefaultPrevented()){u();return}if(k(y,x)){u();return}if(!v){y.preventDefault()}if(a.ie&&(!v||y.ieFake)){j();h.dom.bind(f,"paste",function(z){z.stopPropagation()});h.getDoc().execCommand("Paste",false,null);x["text/html"]=t()}setTimeout(function(){var z=t();if(f&&f.firstChild&&f.firstChild.id==="mcepastebin"){w=true}u();if(!w&&v&&z&&z!=i){x["text/html"]=z}if(z==i||!v){z=x["text/html"]||x["text/plain"]||i;if(z==i){if(!v){h.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")}return}}if(!n(x,"text/html")&&n(x,"text/plain")){w=true}if(w){q(x["text/plain"]||b.innerText(z))}else{p(z)}},0)});h.on("dragstart",function(w){if(w.dataTransfer.types){try{w.dataTransfer.setData("mce-internal",h.selection.getContent())}catch(v){}}});h.on("drop",function(y){var v=d(y);if(v&&!y.isDefaultPrevented()){var w=l(y.dataTransfer);var x=w["mce-internal"]||w["text/html"]||w["text/plain"];if(x){y.preventDefault();h.undoManager.transact(function(){if(w["mce-internal"]){h.execCommand("Delete")}h.selection.setRng(v);if(!w["text/html"]){q(x)}else{p(x)}})}}})}o.pasteHtml=p;o.pasteText=q;h.on("preInit",function(){g();h.parser.addNodeFilter("img",function(v){if(!h.settings.paste_data_images){var w=v.length;while(w--){var x=v[w].attributes.map.src;if(x&&x.indexOf("data:image")===0){if(!v[w].attr("data-mce-object")&&x!==a.transparentSrc){v[w].remove()}}}}})});h.on("PreProcess",function(){h.dom.remove(h.dom.get("mcepastebin"))})}});