tinymce.PluginManager.add("noneditable",function(p){function x(c){var a;if(1===c.nodeType){if(a=c.getAttribute(w),a&&"inherit"!==a){return a}if(a=c.contentEditable,"inherit"!==a){return a}}return null}function h(a){for(var c;a;){if(c=x(a)){return"false"===c?a:null}a=a.parentNode}}function b(){function c(a){for(;a;){if(a.id===y){return a}a=a.parentNode}}function A(d){var a;if(d){for(a=new m(d,d),d=a.current();d;d=a.next()){if(3===d.nodeType){return d}}}}function t(u,o){var d,l;return"false"===x(u)&&B.isBlock(u)?void C.select(u):(l=B.createRng(),"true"===x(u)&&(u.firstChild||u.appendChild(p.getDoc().createTextNode("Â ")),u=u.firstChild,o=!0),d=B.create("span",{id:y,"data-mce-bogus":!0},f),o?u.parentNode.insertBefore(d,u):B.insertAfter(d,u),l.setStart(d.firstChild,1),l.collapse(!0),C.setRng(l),d)}function e(l){var d,u,a,r;if(l){d=C.getRng(!0),d.setStartBefore(l),d.setEndBefore(l),u=A(l),u&&u.nodeValue.charAt(0)==f&&(u=u.deleteData(0,1)),B.remove(l,!0),C.setRng(d)}else{for(a=c(C.getStart());(l=B.get(y))&&l!==r;){a!==l&&(u=A(l),u&&u.nodeValue.charAt(0)==f&&(u=u.deleteData(0,1)),B.remove(l,!0)),r=l}}}function n(){function F(L,N){var K,H,J,M,d;if(K=G.startContainer,H=G.startOffset,3==K.nodeType){if(d=K.nodeValue.length,H>0&&d>H||(N?H==d:0===H)){return}}else{if(!(H<K.childNodes.length)){return N?null:L}var I=!N&&H>0?H-1:H;K=K.childNodes[I],K.hasChildNodes()&&(K=K.firstChild)}for(J=new m(K,L);M=J[N?"prev":"next"]();){if(3===M.nodeType&&M.nodeValue.length>0){return}if("true"===x(M)){return M}}return L}var E,o,i,G,D;e(),i=C.isCollapsed(),E=h(C.getStart()),o=h(C.getEnd()),(E||o)&&(G=C.getRng(!0),i?(E=E||o,(D=F(E,!0))?t(D,!0):(D=F(E,!1))?t(D,!1):C.select(E)):(G=C.getRng(!0),E&&G.setStartBefore(E),o&&G.setEndAfter(o),C.setRng(G)))}function z(K){function D(d,a){for(;d=d[a?"previousSibling":"nextSibling"];){if(3!==d.nodeType||d.nodeValue.length>0){return d}}}function H(d,a){C.select(d),C.collapse(a)}function G(E){function N(d){for(var a=Q;a;){if(a===d){return}a=a.parentNode}B.remove(d),n()}function R(){var d,i,a=p.schema.getNonEmptyElements();for(i=new tinymce.dom.TreeWalker(Q,p.getBody());(d=E?i.prev():i.next())&&!a[d.nodeName.toLowerCase()]&&!(3===d.nodeType&&tinymce.trim(d.nodeValue).length>0);){if("false"===x(d)){return N(d),!0}}return h(d)?!0:!1}var P,Q,S,O;if(C.isCollapsed()){if(P=C.getRng(!0),Q=P.startContainer,S=P.startOffset,Q=c(Q)||Q,O=h(Q)){return N(O),!1}if(3==Q.nodeType&&(E?S>0:S<Q.nodeValue.length)){return !0}if(1==Q.nodeType&&(Q=Q.childNodes[S]||Q),R()){return !1}}return !0}var r,o,L,M,F=K.keyCode;if(L=C.getStart(),M=C.getEnd(),r=h(L)||h(M),r&&(112>F||F>124)&&F!=s.DELETE&&F!=s.BACKSPACE){if((tinymce.isMac?K.metaKey:K.ctrlKey)&&(67==F||88==F||86==F)){return}if(K.preventDefault(),F==s.LEFT||F==s.RIGHT){var J=F==s.LEFT;if(p.dom.isBlock(r)){var u=J?r.previousSibling:r.nextSibling,l=new m(u,u),I=J?l.prev():l.next();H(I,!J)}else{H(r,J)}}}else{if(F==s.LEFT||F==s.RIGHT||F==s.BACKSPACE||F==s.DELETE){if(o=c(L)){if(F==s.LEFT||F==s.BACKSPACE){if(r=D(o,!0),r&&"false"===x(r)){if(K.preventDefault(),F!=s.LEFT){return void B.remove(r)}H(r,!0)}else{e(o)}}if(F==s.RIGHT||F==s.DELETE){if(r=D(o),r&&"false"===x(r)){if(K.preventDefault(),F!=s.RIGHT){return void B.remove(r)}H(r,!1)}else{e(o)}}}if((F==s.BACKSPACE||F==s.DELETE)&&!G(F==s.BACKSPACE)){return K.preventDefault(),!1}}}}var B=p.dom,C=p.selection,y="mce_noneditablecaret",f="";p.on("mousedown",function(d){var a=p.selection.getNode();"false"===x(a)&&a==d.target&&n()}),p.on("mouseup keyup",n),p.on("keydown",z)}function v(d){var f=j.length,e=d.content,c=tinymce.trim(g);if("raw"!=d.format){for(;f--;){e=e.replace(j[f],function(l){var o=arguments,a=o[o.length-2];return a>0&&'"'==e.charAt(a-1)?l:'<span class="'+c+'" data-mce-content="'+p.dom.encode(o[0])+'">'+p.dom.encode("string"==typeof o[1]?o[1]:o[0])+"</span>"})}d.content=e}}var k,g,j,m=tinymce.dom.TreeWalker,q="contenteditable",w="data-mce-"+q,s=tinymce.util.VK;k=" "+tinymce.trim(p.getParam("noneditable_editable_class","mceEditable"))+" ",g=" "+tinymce.trim(p.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",j=p.getParam("noneditable_regexp"),j&&!j.length&&(j=[j]),p.on("PreInit",function(){b(),j&&p.on("BeforeSetContent",v),p.parser.addAttributeFilter("class",function(d){for(var a,f,c=d.length;c--;){f=d[c],a=" "+f.attr("class")+" ",-1!==a.indexOf(k)?f.attr(w,"true"):-1!==a.indexOf(g)&&f.attr(w,"false")}}),p.serializer.addAttributeFilter(w,function(c){for(var a,d=c.length;d--;){a=c[d],j&&a.attr("data-mce-content")?(a.name="#text",a.type=3,a.raw=!0,a.value=a.attr("data-mce-content")):(a.attr(q,null),a.attr(w,null))}}),p.parser.addAttributeFilter(q,function(c){for(var a,d=c.length;d--;){a=c[d],a.attr(w,a.attr(q)),a.attr(q,null)}})}),p.on("drop",function(a){h(a.target)&&a.preventDefault()})});