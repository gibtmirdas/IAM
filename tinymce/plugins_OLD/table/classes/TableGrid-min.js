define("tinymce/tableplugin/TableGrid",["tinymce/util/Tools","tinymce/Env"],function(c,b){var d=c.each;function a(f,e){return parseInt(f.getAttribute(e)||1,10)}return function(m,E){var f,I,A,n,H=m.selection,D=H.dom;function s(){var J=0;f=[];d(["thead","tbody","tfoot"],function(K){var L=D.select("> "+K+" tr",E);d(L,function(M,N){N+=J;d(D.select("> td, > th",M),function(T,O){var P,Q,R,S;if(f[N]){while(f[N][O]){O++}}R=a(T,"rowspan");S=a(T,"colspan");for(Q=N;Q<N+R;Q++){if(!f[Q]){f[Q]=[]}for(P=O;P<O+S;P++){f[Q][P]={part:K,real:Q==N&&P==O,elm:T,rowspan:R,colspan:S}}}})});J+=L.length})}function x(K,J){K=K.cloneNode(J);K.removeAttribute("id");return K}function w(J,L){var K;K=f[L];if(K){return K[J]}}function r(L,J,K){if(L){K=parseInt(K,10);if(K===1){L.removeAttribute(J,1)}else{L.setAttribute(J,K,1)}}}function h(J){return J&&(D.hasClass(J.elm,"mce-item-selected")||J==n)}function i(){var J=[];d(E.rows,function(K){d(K.cells,function(L){if(D.hasClass(L,"mce-item-selected")||(n&&L==n.elm)){J.push(K);return false}})});return J}function q(){var J=D.createRng();J.setStartAfter(E);J.setEndAfter(E);H.setRng(J);D.remove(E)}function e(J){var L,K={};if(m.settings.table_clone_elements!==false){K=c.makeMap((m.settings.table_clone_elements||"strong em b i span font h1 h2 h3 h4 h5 h6 p div").toUpperCase(),/[ ,]/)}c.walk(J,function(N){var M;if(N.nodeType==3){d(D.getParents(N.parentNode,null,J).reverse(),function(O){if(!K[O.nodeName]){return}O=x(O,false);if(!L){L=M=O}else{if(M){M.appendChild(O)}}M=O});if(M){M.innerHTML=b.ie?"&nbsp;":'<br data-mce-bogus="1" />'}return false}},"childNodes");J=x(J,false);r(J,"rowSpan",1);r(J,"colSpan",1);if(L){J.appendChild(L)}else{if(!b.ie){J.innerHTML='<br data-mce-bogus="1" />'}}return J}function p(){var J=D.createRng(),K;d(D.select("tr",E),function(L){if(L.cells.length===0){D.remove(L)}});if(D.select("tr",E).length===0){J.setStartBefore(E);J.setEndBefore(E);H.setRng(J);D.remove(E);return}d(D.select("thead,tbody,tfoot",E),function(L){if(L.rows.length===0){D.remove(L)}});s();if(I){K=f[Math.min(f.length-1,I.y)];if(K){H.select(K[Math.min(K.length-1,I.x)].elm,true);H.collapse(true)}}}function t(P,N,R,O){var M,K,J,L,Q;M=f[N][P].elm.parentNode;for(J=1;J<=R;J++){M=D.getNext(M,"tr");if(M){for(K=P;K>=0;K--){Q=f[N+J][K].elm;if(Q.parentNode==M){for(L=1;L<=O;L++){D.insertAfter(e(Q),Q)}break}}if(K==-1){for(L=1;L<=O;L++){M.insertBefore(e(M.cells[0]),M.cells[0])}}}}}function z(){d(f,function(J,K){d(J,function(M,L){var P,O,N;if(h(M)){M=M.elm;P=a(M,"colspan");O=a(M,"rowspan");if(P>1||O>1){r(M,"rowSpan",1);r(M,"colSpan",1);for(N=0;N<P-1;N++){D.insertAfter(e(M),M)}t(L,K,O-1,P)}}})})}function o(T,Q,W){var P,M,L,V,U,S,O,R,J,K,N;if(T){P=C(T);M=P.x;L=P.y;V=M+(Q-1);U=L+(W-1)}else{I=A=null;d(f,function(X,Y){d(X,function(aa,Z){if(h(aa)){if(!I){I={x:Z,y:Y}}A={x:Z,y:Y}}})});if(I){M=I.x;L=I.y;V=A.x;U=A.y}}R=w(M,L);J=w(V,U);if(R&&J&&R.part==J.part){z();s();R=w(M,L).elm;r(R,"colSpan",(V-M)+1);r(R,"rowSpan",(U-L)+1);for(O=L;O<=U;O++){for(S=M;S<=V;S++){if(!f[O]||!f[O][S]){continue}T=f[O][S].elm;if(T!=R){K=c.grep(T.childNodes);d(K,function(X){R.appendChild(X)});if(K.length){K=c.grep(R.childNodes);N=0;d(K,function(X){if(X.nodeName=="BR"&&D.getAttrib(X,"data-mce-bogus")&&N++<K.length-1){R.removeChild(X)}})}D.remove(T)}}}p()}}function j(N){var J,P,M,O,Q,R,K,S,L;d(f,function(T,U){d(T,function(V){if(h(V)){V=V.elm;Q=V.parentNode;R=x(Q,false);J=U;if(N){return false}}});if(N){return !J}});if(J===undefined){return}for(O=0;O<f[0].length;O++){if(!f[J][O]){continue}P=f[J][O].elm;if(P!=M){if(!N){L=a(P,"rowspan");if(L>1){r(P,"rowSpan",L+1);continue}}else{if(J>0&&f[J-1][O]){S=f[J-1][O].elm;L=a(S,"rowSpan");if(L>1){r(S,"rowSpan",L+1);continue}}}K=e(P);r(K,"colSpan",P.colSpan);R.appendChild(K);M=P}}if(R.hasChildNodes()){if(!N){D.insertAfter(R,Q)}else{Q.parentNode.insertBefore(R,Q)}}}function g(K){var L,J;d(f,function(M){d(M,function(O,N){if(h(O)){L=N;if(K){return false}}});if(K){return !L}});d(f,function(P,Q){var M,N,O;if(!P[L]){return}M=P[L].elm;if(M!=J){O=a(M,"colspan");N=a(M,"rowspan");if(O==1){if(!K){D.insertAfter(e(M),M);t(L,Q,N-1,O)}else{M.parentNode.insertBefore(e(M),M);t(L,Q,N-1,O)}}else{r(M,"colSpan",M.colSpan+1)}J=M}})}function l(){var J=[];d(f,function(K){d(K,function(M,L){if(h(M)&&c.inArray(J,L)===-1){d(f,function(P){var N=P[L].elm,O;O=a(N,"colSpan");if(O>1){r(N,"colSpan",O-1)}else{D.remove(N)}});J.push(L)}})});p()}function k(){var K;function J(N){var M,O,L;M=D.getNext(N,"tr");d(N.cells,function(P){var Q=a(P,"rowSpan");if(Q>1){r(P,"rowSpan",Q-1);O=C(P);t(O.x,O.y,1,1)}});O=C(N.cells[0]);d(f[O.y],function(P){var Q;P=P.elm;if(P!=L){Q=a(P,"rowSpan");if(Q<=1){D.remove(P)}else{r(P,"rowSpan",Q-1)}L=P}})}K=i();d(K.reverse(),function(L){J(L)});p()}function B(){var J=i();D.remove(J);p();return J}function G(){var J=i();d(J,function(L,K){J[K]=x(L,true)});return J}function y(L,K){var M=i(),J=M[K?0:M.length-1],N=J.cells.length;if(!L){return}d(f,function(P){var O;N=0;d(P,function(Q){if(Q.real){N+=Q.colspan}if(Q.elm.parentNode==J){O=1}});if(O){return false}});if(!K){L.reverse()}d(L,function(R){var P,Q=R.cells.length,O;for(P=0;P<Q;P++){O=R.cells[P];r(O,"colSpan",1);r(O,"rowSpan",1)}for(P=Q;P<N;P++){R.appendChild(e(R.cells[Q-1]))}for(P=N;P<Q;P++){D.remove(R.cells[P])}if(K){J.parentNode.insertBefore(R,J)}else{D.insertAfter(R,J)}});D.removeClass(D.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected")}function C(J){var K;d(f,function(L,M){d(L,function(O,N){if(O.elm==J){K={x:N,y:M};return false}});return !K});return K}function v(J){I=C(J)}function F(){var K,J;K=J=0;d(f,function(L,M){d(L,function(O,N){var Q,P;if(h(O)){O=f[M][N];if(N>K){K=N}if(M>J){J=M}if(O.real){Q=O.colspan-1;P=O.rowspan-1;if(Q){if(N+Q>K){K=N+Q}}if(P){if(M+P>J){J=M+P}}}}})});return{x:K,y:J}}function u(R){var M,L,T,S,K,J,N,O,Q,P;A=C(R);if(I&&A){M=Math.min(I.x,A.x);L=Math.min(I.y,A.y);T=Math.max(I.x,A.x);S=Math.max(I.y,A.y);K=T;J=S;for(P=L;P<=J;P++){R=f[P][M];if(!R.real){if(M-(R.colspan-1)<M){M-=R.colspan-1}}}for(Q=M;Q<=K;Q++){R=f[L][Q];if(!R.real){if(L-(R.rowspan-1)<L){L-=R.rowspan-1}}}for(P=L;P<=S;P++){for(Q=M;Q<=T;Q++){R=f[P][Q];if(R.real){N=R.colspan-1;O=R.rowspan-1;if(N){if(Q+N>K){K=Q+N}}if(O){if(P+O>J){J=P+O}}}}}D.removeClass(D.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected");for(P=L;P<=J;P++){for(Q=M;Q<=K;Q++){if(f[P][Q]){D.addClass(f[P][Q].elm,"mce-item-selected")}}}}}E=E||D.getParent(H.getStart(),"table");s();n=D.getParent(H.getStart(),"th,td");if(n){I=C(n);A=F();n=w(I.x,I.y)}c.extend(this,{deleteTable:q,split:z,merge:o,insertRow:j,insertCol:g,deleteCols:l,deleteRows:k,cutRows:B,copyRows:G,pasteRows:y,getPos:C,setStartCell:v,setEndCell:u})}});