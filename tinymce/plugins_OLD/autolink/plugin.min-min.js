tinymce.PluginManager.add("autolink",function(b){function d(e){f(e,-1,"(",!0)}function g(e){f(e,0,"",!0)}function a(e){f(e,-1,"",!1)}function f(z,v,k){var p,j,h,A,w,y,u,m,x;if(p=z.selection.getRng(!0).cloneRange(),p.startOffset<5){if(m=p.endContainer.previousSibling,!m){if(!p.endContainer.firstChild||!p.endContainer.firstChild.nextSibling){return}m=p.endContainer.firstChild.nextSibling}if(x=m.length,p.setStart(m,x),p.setEnd(m,x),p.endOffset<5){return}j=p.endOffset,A=m}else{if(A=p.endContainer,3!=A.nodeType&&A.firstChild){for(;3!=A.nodeType&&A.firstChild;){A=A.firstChild}3==A.nodeType&&(p.setStart(A,0),p.setEnd(A,A.nodeValue.length))}j=1==p.endOffset?2:p.endOffset-1-v}h=j;do{p.setStart(A,j>=2?j-2:0),p.setEnd(A,j>=1?j-1:0),j-=1}while(" "!=p.toString()&&""!==p.toString()&&160!=p.toString().charCodeAt(0)&&j-2>=0&&p.toString()!=k);if(p.toString()==k||160==p.toString().charCodeAt(0)?(p.setStart(A,j),p.setEnd(A,h),j+=1):0===p.startOffset?(p.setStart(A,0),p.setEnd(A,h)):(p.setStart(A,j),p.setEnd(A,h)),y=p.toString(),"."==y.charAt(y.length-1)&&p.setEnd(A,h-1),y=p.toString(),u=y.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i),u&&("www."==u[1]?u[1]="http://www.":/@$/.test(u[1])&&!/^mailto:/.test(u[1])&&(u[1]="mailto:"+u[1]),w=z.selection.getBookmark(),z.selection.setRng(p),z.execCommand("createlink",!1,u[1]+u[2]),z.selection.moveToBookmark(w),z.nodeChanged(),tinymce.Env.webkit)){z.selection.collapse(!1);var q=Math.min(A.length,h+1);p.setStart(A,q),p.setEnd(A,q),z.selection.setRng(p)}}var c;return b.on("keydown",function(h){return 13==h.keyCode?a(b):void 0}),tinymce.Env.ie?void b.on("focus",function(){if(!c){c=!0;try{b.execCommand("AutoUrlDetect",!1,!0)}catch(h){}}}):(b.on("keypress",function(e){return 41==e.which?d(b):void 0}),void b.on("keyup",function(h){return 32==h.keyCode?g(b):void 0}))});