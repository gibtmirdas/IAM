define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools"],function(h,k,b,g,e,d,f,c){var i=c.each,a=c.trim;var j=h.DOM;return function(n,m){var p,o,l;if(m){p=m.dom;o=m.schema}p=p||j;o=o||new d(n);n.entity_encoding=n.entity_encoding||"named";n.remove_trailing_brs="remove_trailing_brs" in n?n.remove_trailing_brs:true;l=new k(n,o);l.addAttributeFilter("data-mce-tabindex",function(q,r){var s=q.length,t;while(s--){t=q[s];t.attr("tabindex",t.attributes.map["data-mce-tabindex"]);t.attr(r,null)}});l.addAttributeFilter("src,href,style",function(r,q){var v=r.length,s,x,u="data-mce-"+q;var w=n.url_converter,y=n.url_converter_scope,t;while(v--){s=r[v];x=s.attributes.map[u];if(x!==t){s.attr(q,x.length>0?x:null);s.attr(u,null)}else{x=s.attributes.map[q];if(q==="style"){x=p.serializeStyle(p.parseStyle(x),s.name)}else{if(w){x=w.call(y,x,q,s.name)}}s.attr(q,x.length>0?x:null)}}});l.addAttributeFilter("class",function(q){var r=q.length,s,t;while(r--){s=q[r];t=s.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,"");s.attr("class",t.length>0?t:null)}});l.addAttributeFilter("data-mce-type",function(q,s,r){var t=q.length,u;while(t--){u=q[t];if(u.attributes.map["data-mce-type"]==="bookmark"&&!r.cleanup){u.remove()}}});l.addAttributeFilter("data-mce-expando",function(q,r){var s=q.length;while(s--){q[s].attr(r,null)}});l.addNodeFilter("noscript",function(q){var r=q.length,s;while(r--){s=q[r].firstChild;if(s){s.value=b.decode(s.value)}}});l.addNodeFilter("script,style",function(r,s){var t=r.length,v,w;function q(x){return x.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}while(t--){v=r[t];w=v.firstChild?v.firstChild.value:"";if(s==="script"){var u=(v.attr("type")||"text/javascript").replace(/^mce\-/,"");v.attr("type",u==="text/javascript"?null:u);if(w.length>0){v.firstChild.value="// <![CDATA[\n"+q(w)+"\n// ]]>"}}else{if(w.length>0){v.firstChild.value="<!--\n"+q(w)+"\n-->"}}}});l.addNodeFilter("#comment",function(q){var r=q.length,s;while(r--){s=q[r];if(s.value.indexOf("[CDATA[")===0){s.name="#cdata";s.type=4;s.value=s.value.replace(/^\[CDATA\[|\]\]$/g,"")}else{if(s.value.indexOf("mce:protected ")===0){s.name="#text";s.type=3;s.raw=true;s.value=unescape(s.value).substr(14)}}}});l.addNodeFilter("xml:namespace,input",function(q,r){var s=q.length,t;while(s--){t=q[s];if(t.type===7){t.remove()}else{if(t.type===1){if(r==="input"&&!("type" in t.attributes.map)){t.attr("type","text")}}}}});if(n.fix_list_elements){l.addNodeFilter("ul,ol",function(r){var s=r.length,t,q;while(s--){t=r[s];q=t.parent;if(q.name==="ul"||q.name==="ol"){if(t.prev&&t.prev.name==="li"){t.prev.append(t)}}}})}l.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected",function(q,r){var s=q.length;while(s--){q[s].attr(r,null)}});return{schema:o,addNodeFilter:l.addNodeFilter,addAttributeFilter:l.addAttributeFilter,serialize:function(w,u){var t=this,s,x,r,q,v;if(f.ie&&p.select("script,style,select,map").length>0){v=w.innerHTML;w=w.cloneNode(false);p.setHTML(w,v)}else{w=w.cloneNode(true)}s=w.ownerDocument.implementation;if(s.createHTMLDocument){x=s.createHTMLDocument("");i(w.nodeName=="BODY"?w.childNodes:[w],function(y){x.body.appendChild(x.importNode(y,true))});if(w.nodeName!="BODY"){w=x.body.firstChild}else{w=x.body}r=p.doc;p.doc=x}u=u||{};u.format=u.format||"html";if(u.selection){u.forced_root_block=""}if(!u.no_events){u.node=w;t.onPreProcess(u)}q=new g(n,o);u.content=q.serialize(l.parse(a(u.getInner?w.innerHTML:p.getOuterHTML(w)),u));if(!u.cleanup){u.content=u.content.replace(/\uFEFF/g,"")}if(!u.no_events){t.onPostProcess(u)}if(r){p.doc=r}u.node=null;return u.content},addRules:function(q){o.addValidElements(q)},setRules:function(q){o.setValidElements(q)},onPreProcess:function(q){if(m){m.fire("PreProcess",q)}},onPostProcess:function(q){if(m){m.fire("PostProcess",q)}}}}});