tinymce.PluginManager.add("importcss",function(d){var b=this,e=tinymce.each;function c(g){if(typeof(g)=="string"){return function(h){return h.indexOf(g)!==-1}}else{if(g instanceof RegExp){return function(h){return g.test(h)}}}return g}function a(l,j){var i=[],h={};function g(q,p){var m=q.href,o;if(!p&&!h[m]){return}if(j&&!j(m)){return}e(q.imports,function(r){g(r,true)});try{o=q.cssRules||q.rules}catch(n){}e(o,function(r){if(r.styleSheet){g(r.styleSheet,true)}else{if(r.selectorText){e(r.selectorText.split(","),function(s){i.push(tinymce.trim(s))})}}})}e(d.contentCSS,function(m){h[m]=true});try{e(l.styleSheets,function(m){g(m)})}catch(k){}return i}function f(k){var l;var h=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(k);if(!h){return}var g=h[1];var i=h[2].substr(1).split(".").join(" ");var j=tinymce.makeMap("a,img");if(h[1]){l={title:k};if(d.schema.getTextBlockElements()[g]){l.block=g}else{if(d.schema.getBlockElements()[g]||j[g.toLowerCase()]){l.selector=g}else{l.inline=g}}}else{if(h[2]){l={inline:"span",title:k.substr(1),classes:i}}}if(d.settings.importcss_merge_classes!==false){l.classes=i}else{l.attributes={"class":i}}return l}d.on("renderFormatsMenu",function(l){var j=d.settings,i={};var h=j.importcss_selector_converter||f;var k=c(j.importcss_selector_filter);if(!d.settings.importcss_append){l.control.items().remove()}var g=[];tinymce.each(j.importcss_groups,function(m){m=tinymce.extend({},m);m.filter=c(m.filter);g.push(m)});e(a(d.getDoc(),c(j.importcss_file_filter)),function(m){if(m.indexOf(".mce-")===-1){if(!i[m]&&(!k||k(m))){var q=h.call(b,m),r;if(q){var p=q.name||tinymce.DOM.uniqueId();if(g){for(var n=0;n<g.length;n++){if(!g[n].filter||g[n].filter(m)){if(!g[n].item){g[n].item={text:g[n].title,menu:[]}}r=g[n].item.menu;break}}}d.formatter.register(p,q);var o=tinymce.extend({},l.control.settings.itemDefaults,{text:q.title,format:p});if(r){r.push(o)}else{l.control.add(o)}}i[m]=true}}});e(g,function(m){l.control.add(m.item)});l.control.renderNew()});b.convertSelectorToFormat=f});