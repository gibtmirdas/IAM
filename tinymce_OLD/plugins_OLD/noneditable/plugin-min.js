tinymce.PluginManager.add("noneditable",function(g){var i=tinymce.dom.TreeWalker;var d="contenteditable",c="data-mce-"+d;var j=tinymce.util.VK;function f(n){var m;if(n.nodeType===1){m=n.getAttribute(c);if(m&&m!=="inherit"){return m}m=n.contentEditable;if(m!=="inherit"){return m}}return null}function a(m){var n;while(m){n=f(m);if(n){return n==="false"?m:null}m=m.parentNode}}function h(){var p=g.dom,t=g.selection,s="mce_noneditablecaret",v="\uFEFF";function r(w){while(w){if(w.id===s){return w}w=w.parentNode}}function q(w){var x;if(w){x=new i(w,w);for(w=x.current();w;w=x.next()){if(w.nodeType===3){return w}}}}function m(z,y){var w,x;if(f(z)==="false"){if(p.isBlock(z)){t.select(z);return}}x=p.createRng();if(f(z)==="true"){if(!z.firstChild){z.appendChild(g.getDoc().createTextNode("\u00a0"))}z=z.firstChild;y=true}w=p.create("span",{id:s,"data-mce-bogus":true},v);if(y){z.parentNode.insertBefore(w,z)}else{p.insertAfter(w,z)}x.setStart(w.firstChild,1);x.collapse(true);t.setRng(x);return w}function o(w){var x,A,y,z;if(w){x=t.getRng(true);x.setStartBefore(w);x.setEndBefore(w);A=q(w);if(A&&A.nodeValue.charAt(0)==v){A=A.deleteData(0,1)}p.remove(w,true);t.setRng(x)}else{y=r(t.getStart());while((w=p.get(s))&&w!==z){if(y!==w){A=q(w);if(A&&A.nodeValue.charAt(0)==v){A=A.deleteData(0,1)}p.remove(w,true)}z=w}}}function u(){var w,A,y,x,z;function B(E,G){var D,I,H,F,C;D=x.startContainer;I=x.startOffset;if(D.nodeType==3){C=D.nodeValue.length;if((I>0&&I<C)||(G?I==C:I===0)){return}}else{if(I<D.childNodes.length){var J=!G&&I>0?I-1:I;D=D.childNodes[J];if(D.hasChildNodes()){D=D.firstChild}}else{return !G?E:null}}H=new i(D,E);while((F=H[G?"prev":"next"]())){if(F.nodeType===3&&F.nodeValue.length>0){return}else{if(f(F)==="true"){return F}}}return E}o();y=t.isCollapsed();w=a(t.getStart());A=a(t.getEnd());if(w||A){x=t.getRng(true);if(y){w=w||A;if((z=B(w,true))){m(z,true)}else{if((z=B(w,false))){m(z,false)}else{t.select(w)}}}else{x=t.getRng(true);if(w){x.setStartBefore(w)}if(A){x.setEndAfter(A)}t.setRng(x)}}}function n(E){var I=E.keyCode,B,F,G,z;function y(K,J){while((K=K[J?"previousSibling":"nextSibling"])){if(K.nodeType!==3||K.nodeValue.length>0){return K}}}function C(J,K){t.select(J);t.collapse(K)}function x(N){var M,L,P,K;function J(R){var Q=L;while(Q){if(Q===R){return}Q=Q.parentNode}p.remove(R);u()}function O(){var R,S,Q=g.schema.getNonEmptyElements();S=new tinymce.dom.TreeWalker(L,g.getBody());while((R=(N?S.prev():S.next()))){if(Q[R.nodeName.toLowerCase()]){break}if(R.nodeType===3&&tinymce.trim(R.nodeValue).length>0){break}if(f(R)==="false"){J(R);return true}}if(a(R)){return true}return false}if(t.isCollapsed()){M=t.getRng(true);L=M.startContainer;P=M.startOffset;L=r(L)||L;if((K=a(L))){J(K);return false}if(L.nodeType==3&&(N?P>0:P<L.nodeValue.length)){return true}if(L.nodeType==1){L=L.childNodes[P]||L}if(O()){return false}}return true}G=t.getStart();z=t.getEnd();B=a(G)||a(z);if(B&&(I<112||I>124)&&I!=j.DELETE&&I!=j.BACKSPACE){if((tinymce.isMac?E.metaKey:E.ctrlKey)&&(I==67||I==88||I==86)){return}E.preventDefault();if(I==j.LEFT||I==j.RIGHT){var A=I==j.LEFT;if(g.dom.isBlock(B)){var D=A?B.previousSibling:B.nextSibling;var w=new i(D,D);var H=A?w.prev():w.next();C(H,!A)}else{C(B,A)}}}else{if(I==j.LEFT||I==j.RIGHT||I==j.BACKSPACE||I==j.DELETE){F=r(G);if(F){if(I==j.LEFT||I==j.BACKSPACE){B=y(F,true);if(B&&f(B)==="false"){E.preventDefault();if(I==j.LEFT){C(B,true)}else{p.remove(B);return}}else{o(F)}}if(I==j.RIGHT||I==j.DELETE){B=y(F);if(B&&f(B)==="false"){E.preventDefault();if(I==j.RIGHT){C(B,false)}else{p.remove(B);return}}else{o(F)}}}if((I==j.BACKSPACE||I==j.DELETE)&&!x(I==j.BACKSPACE)){E.preventDefault();return false}}}}g.on("mousedown",function(x){var w=g.selection.getNode();if(f(w)==="false"&&w==x.target){u()}});g.on("mouseup keyup",u);g.on("keydown",n)}var e,l,b;function k(p){var n=b.length,o=p.content,m=tinymce.trim(l);if(p.format=="raw"){return}while(n--){o=o.replace(b[n],function(s){var r=arguments,q=r[r.length-2];if(q>0&&o.charAt(q-1)=='"'){return s}return('<span class="'+m+'" data-mce-content="'+g.dom.encode(r[0])+'">'+g.dom.encode(typeof(r[1])==="string"?r[1]:r[0])+"</span>")})}p.content=o}e=" "+tinymce.trim(g.getParam("noneditable_editable_class","mceEditable"))+" ";l=" "+tinymce.trim(g.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";b=g.getParam("noneditable_regexp");if(b&&!b.length){b=[b]}g.on("PreInit",function(){h();if(b){g.on("BeforeSetContent",k)}g.parser.addAttributeFilter("class",function(m){var n=m.length,o,p;while(n--){p=m[n];o=" "+p.attr("class")+" ";if(o.indexOf(e)!==-1){p.attr(c,"true")}else{if(o.indexOf(l)!==-1){p.attr(c,"false")}}}});g.serializer.addAttributeFilter(c,function(m){var n=m.length,o;while(n--){o=m[n];if(b&&o.attr("data-mce-content")){o.name="#text";o.type=3;o.raw=true;o.value=o.attr("data-mce-content")}else{o.attr(d,null);o.attr(c,null)}}});g.parser.addAttributeFilter(d,function(m){var n=m.length,o;while(n--){o=m[n];o.attr(c,o.attr(d));o.attr(d,null)}})});g.on("drop",function(m){if(a(m.target)){m.preventDefault()}})});